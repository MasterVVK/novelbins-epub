# ğŸ”„ Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° Ğ³Ğ»Ğ°Ğ²Ñ‹ Ğ½Ğ¾Ğ²ĞµĞ»Ğ»Ñ‹

## ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Ğ¤ĞĞ—Ğ 0: Ğ”ĞĞ‘ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞĞĞ’Ğ•Ğ›Ğ›Ğ«                      â”‚
â”‚                                                                         â”‚
â”‚  ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â†’ Web Interface (/novels/add)                            â”‚
â”‚      â†“                                                                  â”‚
â”‚  Ğ’Ğ²Ğ¾Ğ´Ğ¸Ñ‚: URL Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ° (czbooks.net/book/123)                          â”‚
â”‚      â†“                                                                  â”‚
â”‚  Novel ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ÑÑ Ğ² Ğ‘Ğ”:                                                 â”‚
â”‚    - title, author, source_url                                         â”‚
â”‚    - config (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, Ñ‚ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ°, Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸)                              â”‚
â”‚    - status = 'pending'                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Ğ¤ĞĞ—Ğ 1: ĞŸĞĞ Ğ¡Ğ˜ĞĞ“ (Ğ˜Ğ—Ğ’Ğ›Ğ•Ğ§Ğ•ĞĞ˜Ğ•)                       â”‚
â”‚                                                                         â”‚
â”‚  ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ°Ğ¶Ğ¸Ğ¼Ğ°ĞµÑ‚ "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³" â†’ API Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ                   â”‚
â”‚      â†“                                                                  â”‚
â”‚  Celery Task: parse_novel_chapters_task(novel_id)                      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ñ€ÑĞµÑ€Ğ° Ñ‡ĞµÑ€ĞµĞ· Ñ„Ğ°Ğ±Ñ€Ğ¸ĞºÑƒ                           â”‚      â”‚
â”‚  â”‚    - ParserFactory.create_parser_from_url()                 â”‚      â”‚
â”‚  â”‚    - ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ°: CzbooksParser / QidianParser / EPUB  â”‚      â”‚
â”‚  â”‚    - ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°: SOCKS5 Ğ¿Ñ€Ğ¾ĞºÑĞ¸, cookies, headless mode       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 2. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¿Ğ¸ÑĞºĞ° Ğ³Ğ»Ğ°Ğ²                                    â”‚      â”‚
â”‚  â”‚    parser.get_chapter_list(novel.source_url)                â”‚      â”‚
â”‚  â”‚    â†’ Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº: [{title: 'ç¬¬1ç« ', url: '...'}, ...]            â”‚      â”‚
â”‚  â”‚    â†’ novel.total_chapters = 1000                            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3. Ğ¦Ğ¸ĞºĞ» Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ñ‹ (i = 1..1000)                â”‚      â”‚
â”‚  â”‚    FOR chapter_data IN chapters:                            â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ 3.1 Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°                    â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     parser.get_chapter_content(url)       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     â†’ Selenium Ğ´Ğ»Ñ czbooks (Cloudflare)   â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     â†’ requests Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ…                 â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                    â†“                                         â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ 3.2 Cloudflare Challenge?                â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     â†’ Qwen3-VL Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ     â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     â†’ Ğ˜Ğ»Ğ¸ VNC Ñ€ÑƒÑ‡Ğ½Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ (fallback)  â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                    â†“                                         â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ 3.3 Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°                   â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     filter_text = novel.config['filter']  â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     content = remove_patterns(content)    â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                    â†“                                         â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ 3.4 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Chapter Ğ² Ğ‘Ğ”                â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     Chapter(                             â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       novel_id = novel.id                â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       chapter_number = i                 â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       original_title = 'ç¬¬1ç« '            â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       original_text = content  â† ä¸­æ–‡     â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       status = 'parsed'                  â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     )                                     â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                    â†“                                         â”‚      â”‚
â”‚  â”‚      novel.parsed_chapters += 1                             â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  novel.status = 'parsed' âœ…                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Ğ¤ĞĞ—Ğ 2: ĞŸĞ•Ğ Ğ•Ğ’ĞĞ” (ä¸­æ–‡ â†’ Ğ ÑƒÑÑĞºĞ¸Ğ¹)                      â”‚
â”‚                                                                         â”‚
â”‚  ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ³Ğ»Ğ°Ğ²Ñ‹ â†’ "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´"                       â”‚
â”‚      â†“                                                                  â”‚
â”‚  API Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ: POST /api/novels/{id}/translate                           â”‚
â”‚      â†“                                                                  â”‚
â”‚  Celery Task Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ñ‹ Ğ² Ñ†Ğ¸ĞºĞ»Ğµ                      â”‚
â”‚  (Ğ¸Ğ»Ğ¸ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· ThreadPool)                                    â”‚
â”‚      â†“                                                                  â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚
â”‚  â•‘  TranslatorService.translate_chapter(chapter)                 â•‘    â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 1. ĞŸĞĞ”Ğ“ĞĞ¢ĞĞ’ĞšĞ ĞšĞĞĞ¢Ğ•ĞšĞ¡Ğ¢Ğ                                     â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚      â”‚
â”‚  â”‚  â”‚ 1.1 ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚-ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°                  â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     prompt_template = novel.get_prompt_template()â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     â†’ translation_prompt                       â”‚         â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚      â”‚
â”‚  â”‚                    â†“                                         â”‚      â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚      â”‚
â”‚  â”‚  â”‚ 1.2 Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ TranslationContext               â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     context = TranslationContext(novel_id)     â”‚         â”‚      â”‚
â”‚  â”‚  â”‚                                                 â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚:                                 â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     âœ“ Ğ ĞµĞ·ÑĞ¼Ğµ 5 Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ… Ğ³Ğ»Ğ°Ğ²                â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     âœ“ Ğ“Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ (characters, locations, etc)   â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     âœ“ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ³Ğ»Ğ°Ğ²Ñ‹                   â”‚         â”‚      â”‚
â”‚  â”‚  â”‚                                                 â”‚         â”‚      â”‚
â”‚  â”‚  â”‚     context_prompt = context.build_prompt()    â”‚         â”‚      â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 2. ĞŸĞ Ğ•Ğ”ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞšĞ Ğ¢Ğ•ĞšĞ¡Ğ¢Ğ                                     â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    text_to_translate = preprocess_text(original_text)       â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚:                                               â”‚      â”‚
â”‚  â”‚    - Ğ—Ğ°Ğ¼ĞµĞ½Ğ° Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ĞµĞ½Ğ¸Ğ¹: "Wooooo" â†’ "Wooo..."       â”‚      â”‚
â”‚  â”‚    - ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ²ÑƒĞºĞ¾Ğ²Ñ‹Ñ… ÑÑ„Ñ„ĞµĞºÑ‚Ğ¾Ğ²                         â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 3. Ğ ĞĞ—Ğ‘Ğ˜Ğ•ĞĞ˜Ğ• ĞĞ Ğ§ĞĞ¡Ğ¢Ğ˜ (Ğ´Ğ»Ñ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ğ³Ğ»Ğ°Ğ²)                   â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    text_parts = split_long_text(text, force_small=False)    â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    Ğ›Ğ¾Ğ³Ğ¸ĞºĞ°:                                                  â”‚      â”‚
â”‚  â”‚    - Ğ•ÑĞ»Ğ¸ < 15k ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² â†’ 1 Ñ‡Ğ°ÑÑ‚ÑŒ                         â”‚      â”‚
â”‚  â”‚    - Ğ•ÑĞ»Ğ¸ 15k-30k â†’ 2-3 Ñ‡Ğ°ÑÑ‚Ğ¸                              â”‚      â”‚
â”‚  â”‚    - Ğ•ÑĞ»Ğ¸ > 30k â†’ Ñ€Ğ°Ğ·Ğ±Ğ¸Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ³Ñ€Ğ°Ñ„Ğ°Ğ¼                   â”‚      â”‚
â”‚  â”‚    - ultra_small=True â†’ Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ¿Ğ¾ ~100 ÑĞ»Ğ¾Ğ²                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 4. ĞŸĞ•Ğ Ğ•Ğ’ĞĞ” ĞšĞĞ–Ğ”ĞĞ™ Ğ§ĞĞ¡Ğ¢Ğ˜                                     â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    FOR i, part IN enumerate(text_parts):                    â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚      temperature = novel.config['translation_temperature']  â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚      â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—       â”‚      â”‚
â”‚  â”‚      â•‘ translator.translate_text(                  â•‘       â”‚      â”‚
â”‚  â”‚      â•‘   text=part,                                â•‘       â”‚      â”‚
â”‚  â”‚      â•‘   system_prompt=translation_prompt,         â•‘       â”‚      â”‚
â”‚  â”‚      â•‘   context=context_prompt,                   â•‘       â”‚      â”‚
â”‚  â”‚      â•‘   chapter_id=chapter.id,                    â•‘       â”‚      â”‚
â”‚  â”‚      â•‘   temperature=0.1                           â•‘       â”‚      â”‚
â”‚  â”‚      â•‘ )                                            â•‘       â”‚      â”‚
â”‚  â”‚      â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•       â”‚      â”‚
â”‚  â”‚                         â†“                                    â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ UniversalLLMTranslator                   â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   .make_request_async()                  â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ Ğ•ÑĞ»Ğ¸ Gemini Ñ Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸ĞµĞ¹:                 â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - Ğ¦Ğ¸ĞºĞ» Ğ¿Ğ¾ API ĞºĞ»ÑÑ‡Ğ°Ğ¼                  â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞº failed ĞºĞ»ÑÑ‡ĞµĞ¹               â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ rate limit         â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - Ğ¡Ğ±Ñ€Ğ¾Ñ Ğ¿Ğ¾ÑĞ»Ğµ 3 Ñ†Ğ¸ĞºĞ»Ğ¾Ğ² (5 Ğ¼Ğ¸Ğ½)        â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                         â†“                                    â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ AIAdapterService.generate_content()      â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ ĞÑ†ĞµĞ½Ğ¸Ğ²Ğ°ĞµÑ‚ Ñ‚Ğ¾ĞºĞµĞ½Ñ‹:                        â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - ĞšĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹: 1.5 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°/Ñ‚Ğ¾ĞºĞµĞ½        â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - Ğ ÑƒÑÑĞºĞ¸Ğ¹: 2.5 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ°/Ñ‚Ğ¾ĞºĞµĞ½          â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ Ğ’Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¼ĞµÑ‚Ğ¾Ğ´:                          â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - _call_gemini()                       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - _call_ollama()                       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - _call_openai()                       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   - etc.                                 â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                         â†“                                    â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº AI Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñƒ              â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ Request:                                 â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   POST https://api.provider.com          â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   {                                       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     "model": "gemini-2.0-flash-exp",     â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     "messages": [                        â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       {"role": "system", "content": "..."},â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       {"role": "user", "content": "ä¸­æ–‡"}â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     ],                                    â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     "temperature": 0.1,                  â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     "max_tokens": 8192                   â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   }                                       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ Response:                                â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   {                                       â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     "choices": [{"message": {            â”‚           â”‚      â”‚
â”‚  â”‚      â”‚       "content": "Ğ ÑƒÑÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´..."    â”‚           â”‚      â”‚
â”‚  â”‚      â”‚     }}]                                   â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   }                                       â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                         â†“                                    â”‚      â”‚
â”‚  â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚      â”‚
â”‚  â”‚      â”‚ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº                         â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ PROHIBITED_CONTENT?                      â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   â†’ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ fiction disclaimer          â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   â†’ ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ                     â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   â†’ Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ»Ğ¾: Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ğµ  â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ Rate Limit (Ollama)?                     â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   â†’ 4 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸: 1Ğ¼, 5Ğ¼, 15Ğ¼, 40Ğ¼         â”‚           â”‚      â”‚
â”‚  â”‚      â”‚                                           â”‚           â”‚      â”‚
â”‚  â”‚      â”‚ Server Error 500/502/504?                â”‚           â”‚      â”‚
â”‚  â”‚      â”‚   â†’ 5 Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº: 30Ñ, 2Ğ¼, 5Ğ¼, 10Ğ¼, 20Ğ¼    â”‚           â”‚      â”‚
â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚      â”‚
â”‚  â”‚                         â†“                                    â”‚      â”‚
â”‚  â”‚      translated_parts.append(translated_part)               â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚      time.sleep(1)  # ĞŸĞ°ÑƒĞ·Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ Ñ‡Ğ°ÑÑ‚ÑĞ¼Ğ¸                  â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ 5. ĞĞ‘ĞªĞ•Ğ”Ğ˜ĞĞ•ĞĞ˜Ğ• Ğ˜ Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ•                                 â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    full_translation = "\n\n".join(translated_parts)         â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    Translation(                                             â”‚      â”‚
â”‚  â”‚      chapter_id = chapter.id                                â”‚      â”‚
â”‚  â”‚      translated_title = "Ğ“Ğ»Ğ°Ğ²Ğ° 1: ..."                      â”‚      â”‚
â”‚  â”‚      translated_text = full_translation  â† Ğ ÑƒÑÑĞºĞ¸Ğ¹          â”‚      â”‚
â”‚  â”‚      translation_type = 'initial'  (Ğ½Ğµ Ğ¾Ñ‚Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½)      â”‚      â”‚
â”‚  â”‚      api_used = 'gemini'                                    â”‚      â”‚
â”‚  â”‚      model_used = 'gemini-2.0-flash-exp'                    â”‚      â”‚
â”‚  â”‚      quality_score = None                                   â”‚      â”‚
â”‚  â”‚      translation_time = 45.3                                â”‚      â”‚
â”‚  â”‚    )                                                         â”‚      â”‚
â”‚  â”‚    db.session.add(translation)                              â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚    chapter.status = 'translated' âœ…                         â”‚      â”‚
â”‚  â”‚    novel.translated_chapters += 1                           â”‚      â”‚
â”‚  â”‚    db.session.commit()                                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Ğ¤ĞĞ—Ğ 3: Ğ Ğ•Ğ”ĞĞšĞ¢Ğ£Ğ Ğ (Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°)                 â”‚
â”‚                                                                         â”‚
â”‚  ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ³Ğ»Ğ°Ğ²Ñ‹ â†’ "ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ñ€ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ñƒ"        â”‚
â”‚      â†“                                                                  â”‚
â”‚  API Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ: POST /api/novels/{id}/edit-chapters                       â”‚
â”‚      â†“                                                                  â”‚
â”‚  Celery Task: edit_novel_chapters_task(novel_id, chapter_ids, threads) â”‚
â”‚      â†“                                                                  â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—    â”‚
â”‚  â•‘  ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· ThreadPoolExecutor             â•‘    â”‚
â”‚  â•‘  (parallel_threads = 3 Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)                         â•‘    â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚      â†“                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ñ‹ (Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¼ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞµ):                     â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚ def edit_single_chapter(chapter_id):                        â”‚      â”‚
â”‚  â”‚   with app.app_context():  # Ğ˜Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ñ Ğ‘Ğ”                   â”‚      â”‚
â”‚  â”‚     chapter = Chapter.query.get(chapter_id)                 â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚     # Ğ—ĞĞ©Ğ˜Ğ¢Ğ ĞĞ¢ Ğ”Ğ£Ğ‘Ğ›Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ¯                               â”‚      â”‚
â”‚  â”‚     if chapter.status == 'edited':                          â”‚      â”‚
â”‚  â”‚       return False  # ĞŸÑ€Ğ¾Ğ¿ÑƒÑĞºĞ°ĞµĞ¼                            â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â”‚     â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—      â”‚      â”‚
â”‚  â”‚     â•‘ OriginalAwareEditorService.edit_chapter()     â•‘      â”‚      â”‚
â”‚  â”‚     â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•      â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 1. Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ Ğ”ĞĞĞĞ«Ğ¥                       â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  original_text = chapter.original_text   â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    â†‘ ĞšĞ˜Ğ¢ĞĞ™Ğ¡ĞšĞ˜Ğ™ ĞĞ Ğ˜Ğ“Ğ˜ĞĞĞ›                 â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  translated_text = chapter               â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    .current_translation.translated_text  â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    â†‘ Ğ Ğ£Ğ¡Ğ¡ĞšĞ˜Ğ™ ĞŸĞ•Ğ Ğ•Ğ’ĞĞ” (initial)          â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  glossary = load_prioritized_glossary()  â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    â†‘ Ğ¢Ğ•Ğ ĞœĞ˜ĞĞĞ›ĞĞ“Ğ˜Ğ¯                        â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 2. ĞĞĞĞ›Ğ˜Ğ— Ğ¡ ĞĞ Ğ˜Ğ“Ğ˜ĞĞĞ›ĞĞœ                   â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  strategy = analyze_with_original(        â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    original_text,                        â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    translated_text,                      â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    glossary                              â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  )                                        â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚ LLM:                             â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  "Ğ¡Ñ€Ğ°Ğ²Ğ½Ğ¸ Ñ€ÑƒÑÑĞºĞ¸Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ñ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¼     â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ¾Ğ¼. ĞĞ°Ğ¹Ğ´Ğ¸ Ğ½ĞµÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ñ,      â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸, Ğ½ĞµÑ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸."       â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:                              â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    quality_score: 7/10                   â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    missing_details: [...]                â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    needs_glossary_fix: true              â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    needs_style: true                     â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    needs_dialogue: false                 â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    needs_polish: true                    â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 3. Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• ĞĞ•Ğ¡ĞĞĞ¢Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ™           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  if needs_glossary_fix or missing_details:â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    edited = fix_with_original(            â”‚            â”‚      â”‚
â”‚  â”‚     â”‚      original, edited, glossary          â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    )                                      â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚ LLM:                             â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  "Ğ˜ÑĞ¿Ñ€Ğ°Ğ²ÑŒ Ğ½ĞµÑ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğµ,         â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   ÑĞ²ĞµÑ€ÑÑÑÑŒ Ñ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¼ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ğ¾Ğ¼.       â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑ‰ĞµĞ½Ğ½Ñ‹Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸.             â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ñ‹ Ğ¸Ğ· Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ñ."       â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 4. Ğ£Ğ›Ğ£Ğ§Ğ¨Ğ•ĞĞ˜Ğ• Ğ¡Ğ¢Ğ˜Ğ›Ğ¯                       â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  if needs_style:                         â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    edited = improve_style_with_original(  â”‚            â”‚      â”‚
â”‚  â”‚     â”‚      original, edited, glossary          â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    )                                      â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚ LLM:                             â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  "Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸ Ğ»Ğ¸Ñ‚ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ¸Ğ»ÑŒ,             â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑÑ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°.            â”‚            â”‚      â”‚
â”‚  â”‚     â”‚   ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»Ñƒ."       â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 5. ĞŸĞĞ›Ğ˜Ğ ĞĞ’ĞšĞ Ğ”Ğ˜ĞĞ›ĞĞ“ĞĞ’                    â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  if needs_dialogue:                      â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    edited = polish_dialogues(...)        â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 6. Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ¯ ĞŸĞĞ›Ğ˜Ğ ĞĞ’ĞšĞ                   â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  if needs_polish:                        â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    edited = final_polish(...)            â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚      â”‚
â”‚  â”‚     â”‚ 7. ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ˜ Ğ¡ĞĞ¥Ğ ĞĞĞ•ĞĞ˜Ğ•                 â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  if edited_text == translated_text:      â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    return False  # âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ñ€ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ñ‹   â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  Translation(                            â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    translation_type = 'edited'           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    translated_text = edited_text         â”‚            â”‚      â”‚
â”‚  â”‚     â”‚    quality_score = 10                    â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  )                                        â”‚            â”‚      â”‚
â”‚  â”‚     â”‚                                           â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  chapter.status = 'edited' âœ…            â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  novel.edited_chapters += 1              â”‚            â”‚      â”‚
â”‚  â”‚     â”‚  db.session.commit()                     â”‚            â”‚      â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚      â”‚
â”‚  â”‚                        â†“                                     â”‚      â”‚
â”‚  â”‚     return True  # Ğ£ÑĞ¿ĞµÑ…                                    â”‚      â”‚
â”‚  â”‚                                                              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚      â†“                                                                  â”‚
â”‚  novel.status = 'edited' âœ…                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Ğ¤ĞĞ—Ğ 4: Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ EPUB (ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)                   â”‚
â”‚                                                                         â”‚
â”‚  ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ â†’ "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ²ÑƒÑĞ·Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ EPUB"                             â”‚
â”‚      â†“                                                                  â”‚
â”‚  EPUBService.create_bilingual_epub()                                   â”‚
â”‚      â†“                                                                  â”‚
â”‚  Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ³Ğ»Ğ°Ğ²Ñ‹:                                                     â”‚
â”‚    - Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµÑ‚ bilingual_alignment (ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹ + Ñ€ÑƒÑÑĞºĞ¸Ğ¹ Ğ±Ğ»Ğ¾ĞºĞ¸)        â”‚
â”‚    - Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚: [ä¸­æ–‡] Ñ‚ĞµĞºÑÑ‚\n[Ğ ÑƒÑÑĞºĞ¸Ğ¹] Ñ‚ĞµĞºÑÑ‚                        â”‚
â”‚    - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ² EPUB Ñ„Ğ°Ğ¹Ğ»                                             â”‚
â”‚      â†“                                                                  â”‚
â”‚  novel_title_bilingual.epub âœ…                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                             Ğ˜Ğ¢ĞĞ“ĞĞ’Ğ«Ğ™ Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DATABASE (PostgreSQL)                                         â”‚
â”‚                                                                 â”‚
â”‚  Novel (status='edited')                                       â”‚
â”‚    â”œâ”€ Chapter 1 (status='edited')                             â”‚
â”‚    â”‚    â”œâ”€ original_text: "ç¬¬ä¸€ç«  å¼€å§‹..."      (ä¸­æ–‡ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ») â”‚
â”‚    â”‚    â”œâ”€ Translation (type='initial'): "Ğ“Ğ»Ğ°Ğ²Ğ° 1..."  (Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´) â”‚
â”‚    â”‚    â”œâ”€ Translation (type='edited'): "Ğ“Ğ»Ğ°Ğ²Ğ° 1..."  (Ñ€ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ğ°) â”‚
â”‚    â”‚    â””â”€ BilingualAlignment: [{zh: "...", ru: "..."}]       â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”œâ”€ Chapter 2 (status='edited')                             â”‚
â”‚    â”‚    â””â”€ ...                                                 â”‚
â”‚    â”‚                                                            â”‚
â”‚    â””â”€ Chapter 1000 (status='edited')                          â”‚
â”‚                                                                 â”‚
â”‚  Glossary Items:                                               â”‚
â”‚    â”œâ”€ 'Qi Condensation' â†’ 'ĞšĞ¾Ğ½Ğ´ĞµĞ½ÑĞ°Ñ†Ğ¸Ñ Ğ¦Ğ¸'                   â”‚
â”‚    â”œâ”€ 'Bai Xiaochun' â†’ 'Ğ‘Ğ°Ğ¹ Ğ¡ÑĞ¾Ñ‡ÑƒĞ½ÑŒ'                         â”‚
â”‚    â””â”€ ...                                                      â”‚
â”‚                                                                 â”‚
â”‚  Prompt History: (Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸)                                â”‚
â”‚    â””â”€ Ğ’ÑĞµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñ‹ + Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ LLM                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹

### ğŸ”‘ Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹:

1. **Original-Aware Editing** - Ğ ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ°
2. **Smart Key Rotation** - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¶Ğ´Ñƒ API ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ¿Ñ€Ğ¸ rate limits
3. **Context-Rich Translation** - ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑĞ¼Ğµ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ñ… Ğ³Ğ»Ğ°Ğ² + Ñ‚ĞµÑ€Ğ¼Ğ¸Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹
4. **Multi-Stage Processing** - 5 ÑÑ‚Ğ°Ğ¿Ğ¾Ğ² Ñ€ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ°
5. **Adaptive Text Splitting** - Ğ Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ğ¸ Ñ ÑƒÑ‡ĞµÑ‚Ğ¾Ğ¼ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ¾Ğº ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ°
6. **Multi-Provider Support** - Gemini, OpenAI, Anthropic, Ollama, OpenRouter
7. **Thread-Safe Parallelism** - Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· ThreadPoolExecutor

### âš™ï¸ ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹:

- `translation_model`: Ğ’Ñ‹Ğ±Ğ¾Ñ€ AI Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ (gemini, ollama, gpt-4)
- `translation_temperature`: ĞšÑ€ĞµĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğ° (0.1 = Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ)
- `editing_threads`: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ² (1-10, Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ 3)
- `filter_text`: Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ´Ğ»Ñ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹/Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ğ½Ğ¸Ğ¹
- API ĞºĞ»ÑÑ‡Ğ¸ Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ¹ Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸ĞµĞ¹ (Ğ´Ğ»Ñ Gemini)

### ğŸ“Š ĞÑ†ĞµĞ½ĞºĞ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸:

**Ğ”Ğ»Ñ Ğ½Ğ¾Ğ²ĞµĞ»Ğ»Ñ‹ 1000 Ğ³Ğ»Ğ°Ğ² Ñ 3 Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°Ğ¼Ğ¸:**
- ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³: ~2-4 Ñ‡Ğ°ÑĞ°
- ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´: ~8-17 Ñ‡Ğ°ÑĞ¾Ğ²
- Ğ ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ğ°: ~11-22 Ñ‡Ğ°ÑĞ°
- **Ğ˜Ğ¢ĞĞ“Ğ: ~24-48 Ñ‡Ğ°ÑĞ¾Ğ²** (Ğ±ĞµĞ· Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº)

**Ğ¡ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¾Ğ¹ (3 Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ°):**
- Ğ ĞµĞ´Ğ°ĞºÑ‚ÑƒÑ€Ğ°: ~4-8 Ñ‡Ğ°ÑĞ¾Ğ² (3x ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ)
- **Ğ˜Ğ¢ĞĞ“Ğ: ~14-29 Ñ‡Ğ°ÑĞ¾Ğ²**

---

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** 2025-11-24
