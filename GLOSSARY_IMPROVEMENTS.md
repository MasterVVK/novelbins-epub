# Рекомендации по улучшению системы глоссария

## 1. Приоритизация терминов по важности

### Добавить в модель GlossaryItem:
```python
priority = Column(Integer, default=5)  # 1-10, где 10 - критически важно
context_examples = Column(JSON)  # Примеры использования
alternative_translations = Column(JSON)  # Альтернативные варианты
```

### Автоматическая приоритизация:
- Главные персонажи: приоритет 10
- Второстепенные персонажи: приоритет 7
- Важные локации: приоритет 8
- Редкие термины: приоритет 3-5

## 2. Улучшенное извлечение терминов

### Извлекать из ПЕРЕВЕДЕННОГО текста:
```python
def extract_new_terms_from_translation(self, translated_text: str, original_text: str):
    """Извлечение терминов из перевода с сопоставлением оригинала"""
    # 1. Извлекаем термины из перевода
    # 2. Сопоставляем с оригиналом для поиска китайских эквивалентов
    # 3. Сохраняем с контекстом использования
```

### Сохранять контекст:
- Предложение где используется термин
- Частота использования в главе
- Связанные термины

## 3. Умная подача в промпт

### Адаптивная загрузка:
```python
def build_smart_glossary_prompt(self, chapter_text: str, max_terms: int = 100):
    """Загружаем только релевантные термины"""
    # 1. Анализируем текст главы
    # 2. Предсказываем какие термины понадобятся
    # 3. Загружаем топ-100 по приоритету + релевантности
```

### Форматирование по важности:
```
КРИТИЧЕСКИ ВАЖНЫЕ ТЕРМИНЫ (всегда используйте эти переводы):
- 韩立 → Хань Ли (главный герой)
- 仙界 → Бессмертный Мир (основная локация)

ВАЖНЫЕ ТЕРМИНЫ:
- 灵石 → Духовный камень (валюта мира)

СПРАВОЧНЫЕ ТЕРМИНЫ:
- ... остальные термины
```

## 4. Версионность и обновление

### Tracking изменений:
```python
class GlossaryVersion(db.Model):
    id = Column(Integer, primary_key=True)
    glossary_item_id = Column(Integer, ForeignKey('glossary_items.id'))
    old_translation = Column(String(255))
    new_translation = Column(String(255))
    changed_at = Column(DateTime)
    reason = Column(Text)
```

### Batch обновление старых глав:
```python
def update_old_chapters_with_new_glossary(novel_id: int, changed_terms: Dict):
    """Обновляем старые переводы при изменении глоссария"""
    # Опционально, по запросу
```

## 5. Интеллектуальная валидация

### Проверка консистентности:
```python
def validate_glossary_consistency(novel_id: int):
    """Находим конфликты и несоответствия"""
    # Han Li vs Хань Ли в разных главах
    # Одинаковые переводы для разных терминов
    # Пропущенные важные термины
```

### ML-based проверка качества:
- Использовать embedding для поиска семантически близких терминов
- Автоматическое обнаружение дубликатов
- Предложения по улучшению переводов

## 6. Экспорт/Импорт для переиспользования

### Шаблоны глоссариев:
```python
class GlossaryTemplate(db.Model):
    """Переиспользуемые глоссарии для похожих новелл"""
    id = Column(Integer, primary_key=True)
    name = Column(String(255))  # "Стандартный Сянься глоссарий"
    genre = Column(String(100))  # "xianxia", "wuxia", etc.
    terms = Column(JSON)
```

### Автоматический импорт базовых терминов:
- При создании новой новеллы жанра Сянься
- Импортировать стандартные термины культивации
- Экономия времени на начальных главах

## 7. Интеграция с редактурой

### Использование глоссария при редактировании:
```python
def edit_with_glossary_check(text: str, glossary: Dict):
    """Проверяем соответствие глоссарию при редактуре"""
    # Находим несоответствия
    # Предлагаем исправления
    # Обновляем глоссарий если нужно
```

## Ожидаемый эффект от улучшений:

- **Точность перевода**: +35-45% (вместо текущих +25-35%)
- **Скорость обработки**: -10% токенов (меньше промпт)
- **Консистентность**: 95%+ (вместо текущих 80%)
- **Удобство редактирования**: значительное улучшение

## Приоритет внедрения:

1. **Высокий**: Приоритизация и умная подача (быстрый эффект)
2. **Средний**: Извлечение из перевода (улучшение качества)
3. **Низкий**: Версионность и ML-валидация (долгосрочные улучшения)