# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Ollama: Hourly Usage Limit

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Ollama API (–æ—Å–æ–±–µ–Ω–Ω–æ —Å –æ–±–ª–∞—á–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:
```
–û—à–∏–±–∫–∞ Ollama: you've reached your hourly usage limit, please upgrade to continue
```

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç—Ç–æ–π –æ—à–∏–±–∫–∏ —Å **–ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏**.

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–≤—Ç–æ—Ä–æ–≤

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ `hourly usage limit` —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç **4 –ø–æ–ø—ã—Ç–∫–∏** —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º–∏—Å—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏:

1. **–ü–æ–ø—ã—Ç–∫–∞ 1**: –û–∂–∏–¥–∞–Ω–∏–µ **1 –º–∏–Ω—É—Ç–∞** (60 —Å–µ–∫)
2. **–ü–æ–ø—ã—Ç–∫–∞ 2**: –û–∂–∏–¥–∞–Ω–∏–µ **5 –º–∏–Ω—É—Ç** (300 —Å–µ–∫)
3. **–ü–æ–ø—ã—Ç–∫–∞ 3**: –û–∂–∏–¥–∞–Ω–∏–µ **15 –º–∏–Ω—É—Ç** (900 —Å–µ–∫)
4. **–ü–æ–ø—ã—Ç–∫–∞ 4**: –û–∂–∏–¥–∞–Ω–∏–µ **40 –º–∏–Ω—É—Ç** (2400 —Å–µ–∫)

**–û–±—â–µ–µ –≤—Ä–µ–º—è**: ~**61 –º–∏–Ω—É—Ç–∞** (–ø–æ–∫—Ä—ã–≤–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ª–∏–º–∏—Ç)

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`web_app/app/services/ai_adapter_service.py`** (—Å—Ç—Ä–æ–∫–∏ 380-393)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ `error_type`
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ "hourly usage limit" –∏–ª–∏ "usage limit"
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `error_type = 'rate_limit'` –¥–ª—è —Ç–∞–∫–∏—Ö–æ—à–∏–±–æ–∫

2. **`web_app/app/services/universal_llm_translator.py`** (—Å—Ç—Ä–æ–∫–∏ 210-280)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ `rate_limit` –¥–ª—è Ollama —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏ –ø–æ–≤—Ç–æ—Ä–∞–º–∏
   - –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏:
     - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ü–∏–∫–ª –∏–∑ 4 –ø–æ–ø—ã—Ç–æ–∫
     - –ö–∞–∂–¥–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∏–º–µ–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–π—Å—è –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–∂–∏–¥–∞–Ω–∏—è
     - –í–æ –≤—Ä–µ–º—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—É–∑ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è (–∫–∞–∂–¥—ã–µ 60 —Å–µ–∫)
     - –ï—Å–ª–∏ —É—Å–ø–µ—Ö –Ω–∞ –ª—é–±–æ–π –ø–æ–ø—ã—Ç–∫–µ ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
     - –ï—Å–ª–∏ –Ω–∞ –ª—é–±–æ–π –ø–æ–ø—ã—Ç–∫–µ –¥—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ (–Ω–µ rate_limit) ‚Üí –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥
     - –ï—Å–ª–∏ –≤—Å–µ 4 –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—É–¥–∞—á–Ω—ã ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—à–∏–±–∫–∏ –≤ `prompt_history`

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£—Å–ø–µ—Ö –Ω–∞ –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–µ

```
21:33:36 ERROR [system] –û—à–∏–±–∫–∞ ollama: –û—à–∏–±–∫–∞ Ollama: you've reached your hourly usage limit
21:33:36 WARNING [system] ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç —á–∞—Å–æ–≤–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ kimi-k2:1t-cloud
21:33:36 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 1/4: –û–∂–∏–¥–∞–Ω–∏–µ 1 –º–∏–Ω—É—Ç—É –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
[–û–∂–∏–¥–∞–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥]
21:34:36 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:34:40 INFO [system] ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1 —É—Å–ø–µ—à–Ω–∞!
21:34:40 INFO [system] –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ç–∏–ø: translation, —É—Å–ø–µ—Ö: True)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –õ–∏–º–∏—Ç –≤—Å—ë –µ—â—ë –∞–∫—Ç–∏–≤–µ–Ω, —É—Å–ø–µ—Ö –Ω–∞ –≤—Ç–æ—Ä–æ–π –ø–æ–ø—ã—Ç–∫–µ

```
21:33:36 WARNING [system] ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç —á–∞—Å–æ–≤–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ kimi-k2:1t-cloud
21:33:36 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 1/4: –û–∂–∏–¥–∞–Ω–∏–µ 1 –º–∏–Ω—É—Ç—É –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
[–û–∂–∏–¥–∞–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥]
21:34:36 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:34:40 WARNING [system] ‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ 1 –Ω–µ—É–¥–∞—á–Ω–∞: –≤—Å—ë –µ—â—ë –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç
21:34:40 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 2/4: –û–∂–∏–¥–∞–Ω–∏–µ 5 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
21:35:40 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 4 –º–∏–Ω 0 —Å–µ–∫
21:36:40 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 3 –º–∏–Ω 0 —Å–µ–∫
21:37:40 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 2 –º–∏–Ω 0 —Å–µ–∫
21:38:40 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 1 –º–∏–Ω 0 —Å–µ–∫
[–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ]
21:39:40 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 2/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:39:45 INFO [system] ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 2 —É—Å–ø–µ—à–Ω–∞!
21:39:45 INFO [system] –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ç–∏–ø: translation, —É—Å–ø–µ—Ö: True)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ–Ω–∞ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–æ–≤)

```
21:33:36 WARNING [system] ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç —á–∞—Å–æ–≤–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ kimi-k2:1t-cloud
21:33:36 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 1/4: –û–∂–∏–¥–∞–Ω–∏–µ 1 –º–∏–Ω—É—Ç—É –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
[–û–∂–∏–¥–∞–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥]
21:34:36 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:34:40 ERROR [system] ‚ùå –ü–æ–ø—ã—Ç–∫–∞ 1 –Ω–µ—É–¥–∞—á–Ω–∞: –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (—Ç–∏–ø: model_not_found)
21:34:40 ERROR [system] üõë –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–æ–≤ –∏–∑-–∑–∞ —Å–º–µ–Ω—ã —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏
21:34:40 INFO [system] –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ç–∏–ø: translation, —É—Å–ø–µ—Ö: False)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã

```
[–ü–æ—Å–ª–µ 4 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ 1 –º–∏–Ω, 5 –º–∏–Ω, 15 –º–∏–Ω, 40 –º–∏–Ω]
22:34:36 ERROR [system] ‚ùå –í—Å–µ 4 –ø–æ–ø—ã—Ç–æ–∫ –∏—Å—á–µ—Ä–ø–∞–Ω—ã, –ª–∏–º–∏—Ç –≤—Å—ë –µ—â—ë –Ω–µ —Å–Ω—è—Ç
22:34:36 ERROR [system] üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å
22:34:36 INFO [system] –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ç–∏–ø: translation, —É—Å–ø–µ—Ö: False)
```

## –¢–∏–ø—ã –æ—à–∏–±–æ–∫

–¢–µ–ø–µ—Ä—å –≤—Å–µ –æ—à–∏–±–∫–∏ –æ—Ç Ollama –∏–º–µ—é—Ç –ø–æ–ª–µ `error_type`:

- `'rate_limit'` - –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (hourly/daily)
- `'model_not_found'` - –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- `'general'` - –æ–±—â–∞—è –æ—à–∏–±–∫–∞

## –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤

–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ (—É—Å–ø–µ—à–Ω—ã–µ –∏ –Ω–µ—É–¥–∞—á–Ω—ã–µ) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `prompt_history`:

```sql
SELECT
    id,
    chapter_id,
    prompt_type,
    success,
    error_message,
    execution_time,
    created_at
FROM prompt_history
WHERE success = 0 AND error_message LIKE '%usage limit%'
ORDER BY created_at DESC;
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
python3 test_ollama_error_handling.py
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ hourly usage limit
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ error_type = 'rate_limit'
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ 60 —Å–µ–∫—É–Ω–¥
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –£—Å–ø–µ—Ö –Ω–∞ –ø–µ—Ä–≤–æ–π –ø–æ–ø—ã—Ç–∫–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ)

```
21:33:36 INFO [translator] –ü–µ—Ä–µ–≤–æ–¥ —á–∞—Å—Ç–∏ 1/1 –≥–ª–∞–≤—ã 12
21:33:36 INFO [translator] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–µ—Ä–µ–≤–æ–¥ —á–∞—Å—Ç–∏ 1 —Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π 0.1
21:33:36 INFO [system] –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å –∫ ollama (–º–æ–¥–µ–ª—å: kimi-k2:1t-cloud)
21:33:36 INFO [system] Temperature: 0.1, Num predict: 256000
21:33:36 ERROR [system] –û—à–∏–±–∫–∞ ollama: –û—à–∏–±–∫–∞ Ollama: you've reached your hourly usage limit
21:33:36 WARNING [system] ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç —á–∞—Å–æ–≤–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ kimi-k2:1t-cloud
21:33:36 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 1/4: –û–∂–∏–¥–∞–Ω–∏–µ 1 –º–∏–Ω—É—Ç—É –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
[–û–∂–∏–¥–∞–Ω–∏–µ 60 —Å–µ–∫—É–Ω–¥]
21:34:36 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:34:40 INFO [system] ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1 —É—Å–ø–µ—à–Ω–∞!
21:34:40 INFO [system] –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ç–∏–ø: translation, —É—Å–ø–µ—Ö: True)
21:34:40 INFO [translator] –ß–∞—Å—Ç—å 1 –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ
```

### –ü—Ä–∏–º–µ—Ä 2: –£—Å–ø–µ—Ö –Ω–∞ —Ç—Ä–µ—Ç—å–µ–π –ø–æ–ø—ã—Ç–∫–µ (21 –º–∏–Ω—É—Ç–∞ –æ–∂–∏–¥–∞–Ω–∏—è)

```
21:33:36 ERROR [system] –û—à–∏–±–∫–∞ ollama: –û—à–∏–±–∫–∞ Ollama: you've reached your hourly usage limit
21:33:36 WARNING [system] ‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç —á–∞—Å–æ–≤–æ–π –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏ kimi-k2:1t-cloud
21:33:36 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 1/4: –û–∂–∏–¥–∞–Ω–∏–µ 1 –º–∏–Ω—É—Ç—É –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
[60 —Å–µ–∫—É–Ω–¥]
21:34:36 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 1/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:34:40 WARNING [system] ‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ 1 –Ω–µ—É–¥–∞—á–Ω–∞: –≤—Å—ë –µ—â—ë –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç
21:34:40 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 2/4: –û–∂–∏–¥–∞–Ω–∏–µ 5 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
21:35:40 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 4 –º–∏–Ω 0 —Å–µ–∫
[...–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫...]
21:39:40 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 2/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:39:45 WARNING [system] ‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ 2 –Ω–µ—É–¥–∞—á–Ω–∞: –≤—Å—ë –µ—â—ë –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç
21:39:45 WARNING [system] ‚è≥ –ü–æ–ø—ã—Ç–∫–∞ 3/4: –û–∂–∏–¥–∞–Ω–∏–µ 15 –º–∏–Ω—É—Ç –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º...
21:40:45 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 14 –º–∏–Ω 0 —Å–µ–∫
[...–ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –ª–æ–≥–∏...]
21:54:45 INFO [system] üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 3/4 –∑–∞–ø—Ä–æ—Å–∞ –∫ kimi-k2:1t-cloud
21:54:50 INFO [system] ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ 3 —É—Å–ø–µ—à–Ω–∞!
[–û–±—â–µ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: 1 + 5 + 15 = 21 –º–∏–Ω—É—Ç–∞]
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** - —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
2. **–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** - –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤–µ—Å—å —á–∞—Å–æ–≤–æ–π –ø–µ—Ä–∏–æ–¥ (60 –º–∏–Ω—É—Ç)
3. **–£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ç–∏–ø–∞ –æ—à–∏–±–∫–∏ (–Ω–µ —Ç—Ä–∞—Ç–∏–º –≤—Ä–µ–º—è –∑—Ä—è)
4. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ —ç—Ç–∞–ø—ã –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è, —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏
5. **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
6. **–ò—Å—Ç–æ—Ä–∏—è** - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `prompt_history` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
7. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ –ª–æ–≥–∏

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–æ–≤

–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è –ø–æ–≤—Ç–æ—Ä–æ–≤ —Ç–∏–ø –æ—à–∏–±–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–¥–µ–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π), —Å–∏—Å—Ç–µ–º–∞ **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç** —Ü–∏–∫–ª –ø–æ–≤—Ç–æ—Ä–æ–≤ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∂–¥–∞—Ç—å:

```python
if retry_error_type == 'rate_limit':
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–≤—Ç–æ—Ä—ã
    continue
else:
    # –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞ - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    break
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏

–î–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—É–∑ (>60 —Å–µ–∫) —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É:

```
21:40:45 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 14 –º–∏–Ω 0 —Å–µ–∫
21:41:45 INFO [system]    ‚è±Ô∏è  –û—Å—Ç–∞–ª–æ—Å—å: 13 –º–∏–Ω 0 —Å–µ–∫
...
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç.

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫: **4**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è: **~61 –º–∏–Ω—É—Ç–∞**
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã (–Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ UI)
- –ü–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–≤–æ–¥ –≥–ª–∞–≤—ã –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è

## –í–æ–∑–º–æ–∂–Ω—ã–µ –±—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø–æ–≤—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤–µ–ª–ª—ã)
2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
3. Fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å –ø–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (WebSocket)
5. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω–∏—Ç—å –æ–∂–∏–¥–∞–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
6. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤ –ø–æ –º–æ–¥–µ–ª—è–º
