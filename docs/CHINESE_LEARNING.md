# Chinese Learning Features - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

> –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Ñ—É–Ω–∫—Ü–∏–π –∏–∑—É—á–µ–Ω–∏—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞.
> –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–º CLAUDE.md.

---

## Chinese Learning Features (NEW!)

**–§—É–Ω–∫—Ü–∏–∏ –∏–∑—É—á–µ–Ω–∏—è –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —á–µ—Ä–µ–∑ –¥–≤—É—è–∑—ã—á–Ω—ã–µ EPUB**

### –ö–∏—Ç–∞–π—Å–∫–æ-—Ä—É—Å—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å BKRS

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `web_app/data/bkrs/` (–ù–ï –≤–∫–ª—é—á–µ–Ω –≤ git)

**–§–∞–π–ª—ã —Å–ª–æ–≤–∞—Ä—è** (StarDict —Ñ–æ—Ä–º–∞—Ç):
- `dabkrs.dict` (~250MB) - —Å–ª–æ–≤–∞—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
- `dabkrs.idx` (~60MB) - –∏–Ω–¥–µ–∫—Å
- `dabkrs.ifo` (~1KB) - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

**–°–µ—Ä–≤–∏—Å**: `web_app/app/utils/chinese_dictionary.py`

```python
class ChineseRussianDictionary:
    """
    Singleton –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–ª–æ–≤–∞—Ä–µ–º BKRS
    - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ (~30 —Å–µ–∫)
    - –•—Ä–∞–Ω–∏—Ç 2+ –º–∏–ª–ª–∏–æ–Ω–∞ —Å–ª–æ–≤ –≤ –ø–∞–º—è—Ç–∏
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç StarDict —Ñ–æ—Ä–º–∞—Ç (null-terminated strings + big-endian offsets)
    """

    @classmethod
    def get_instance(cls) -> 'ChineseRussianDictionary':
        """–ü–æ–ª—É—á–∏—Ç—å singleton —ç–∫–∑–µ–º–ø–ª—è—Ä"""

    def lookup(self, word: str) -> Optional[str]:
        """–ü–æ–∏—Å–∫ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å–ª–æ–≤–∞"""

    def lookup_char(self, char: str) -> Optional[str]:
        """–ü–æ–∏—Å–∫ –ø–µ—Ä–µ–≤–æ–¥–∞ –æ–¥–Ω–æ–≥–æ –∏–µ—Ä–æ–≥–ª–∏—Ñ–∞"""
```

**–§–æ—Ä–º–∞—Ç —Å–ª–æ–≤–∞—Ä–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π BKRS**:
```
–∏–µ—Ä–æ–≥–ª–∏—Ñ<hr>pinyin<hr>–∑–Ω–∞—á–µ–Ω–∏—è
```

**–ü–∞—Ä—Å–∏–Ω–≥ —Å–ª–æ–≤–∞—Ä—è** (`_clean_html` –º–µ—Ç–æ–¥):
1. –†–∞–∑–±–∏–≤–∞–µ—Ç –ø–æ `<hr>` —Ç–µ–≥–∞–º
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤—Å–µ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–¥–æ 6): `1) –∑–Ω–∞—á–µ–Ω–∏–µ 2) –∑–Ω–∞—á–µ–Ω–∏–µ`
3. –£–±–∏—Ä–∞–µ—Ç pinyin –≤ –Ω–∞—á–∞–ª–µ, –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–º–µ—Ç–∫–∏, –ø—Ä–∏–º–µ—Ä—ã
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `;`

**–ü—Ä–∏–º–µ—Ä**:
- –í—Ö–æ–¥: `Ê∞î ‚Üí q√¨ ‚Üí 1) –≥–∞–∑ 2) –≤–æ–∑–¥—É—Ö 3) –¥—É—Ö 4) –≥–Ω–µ–≤ 5) —ç–Ω–µ—Ä–≥–∏—è —Ü–∏...`
- –í—ã—Ö–æ–¥: `"–≥–∞–∑; –≤–æ–∑–¥—É—Ö; –¥—É—Ö; –≥–Ω–µ–≤; —ç–Ω–µ—Ä–≥–∏—è —Ü–∏"`

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤

**–°–µ—Ä–≤–∏—Å**: `web_app/app/utils/character_stats.py`

**–ö–ª–∞—Å—Å—ã**:

1. **PinyinHelper** - —Ä–∞–±–æ—Ç–∞ —Å pinyin:
   ```python
   PinyinHelper.get_pinyin('‰ªñ')  # ‚Üí 'tƒÅ'
   PinyinHelper.add_ruby_tags('‰Ω†Â•Ω')  # ‚Üí '<ruby>‰Ω†<rt>n«ê</rt></ruby>...'
   ```

2. **CharacterStatsTracker** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–ª–∞–≤–∞–º/–∫–Ω–∏–≥–µ:
   ```python
   tracker = CharacterStatsTracker()
   stats = tracker.process_chapter(1, chinese_text)
   # stats['top_20'] = [{'char': '‰ªñ', 'pinyin': 'tƒÅ', 'count': 42}, ...]
   # stats['new_chars'] = [...–∏–µ—Ä–æ–≥–ª–∏—Ñ—ã –≤–ø–µ—Ä–≤—ã–µ –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω—ã–µ –≤ –∫–Ω–∏–≥–µ...]
   ```

3. **format_chapter_stats_html()** - HTML –¥–ª—è EPUB:
   ```python
   html = format_chapter_stats_html(stats, dictionary)
   # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–ª–æ–∫ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –∫–æ–Ω–µ—Ü –≥–ª–∞–≤—ã:
   # üìä –¢–æ–ø-20 –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤
   # ‰ªñ (tƒÅ) ‚Äî –æ–Ω, –µ–≥–æ [42√ó]
   # ÁöÑ (de) ‚Äî –ø—Ä–∏—Ç—è–∂–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç–∏—Ü–∞ [38√ó]
   # ...
   ```

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å BKRS

**–°–ª–æ–≤–∞—Ä—å –ù–ï –≤–∫–ª—é—á–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –∏–∑-–∑–∞ —Ä–∞–∑–º–µ—Ä–∞ (~300MB).

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**:
```bash
# 1. –°–∫–∞—á–∞—Ç—å —Å https://bkrs.info/ (—Ä–∞–∑–¥–µ–ª "–°–ª–æ–≤–∞—Ä–∏")
# –§–∞–π–ª—ã: dabkrs.dict.dz, dabkrs.idx.gz, dabkrs.ifo

# 2. –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å
mkdir -p web_app/data/bkrs
gunzip dabkrs.dict.dz -c > web_app/data/bkrs/dabkrs.dict
gunzip dabkrs.idx.gz -c > web_app/data/bkrs/dabkrs.idx
cp dabkrs.ifo web_app/data/bkrs/

# 3. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ .gitignore
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å EPUB

–í `EPUBService` (`epub_service.py`) –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–≤—É—è–∑—ã—á–Ω–æ–≥–æ EPUB:
1. `CharacterStatsTracker` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –≥–ª–∞–≤—É
2. `format_chapter_stats_html()` —Å–æ–∑–¥–∞–µ—Ç HTML –±–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
3. –ë–ª–æ–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü –∫–∞–∂–¥–æ–π –≥–ª–∞–≤—ã

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –≤ EPUB**:
```
üìä –¢–æ–ø-20 –∏–µ—Ä–æ–≥–ª–∏—Ñ–æ–≤
‰ªñ (tƒÅ) ‚Äî –æ–Ω, –µ–≥–æ; —Ç–æ—Ç [42√ó]
‰øÆ (xi≈´) ‚Äî —á–∏–Ω–∏—Ç—å; —Å—Ç—Ä–æ–∏—Ç—å; —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å; –∫—É–ª—å—Ç–∏–≤–∞—Ü–∏—è [28√ó]
Áúü (zhƒìn) ‚Äî –Ω–∞—Å—Ç–æ—è—â–∏–π; –∏—Å—Ç–∏–Ω–Ω—ã–π; –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ [25√ó]
Ê∞î (q√¨) ‚Äî –≥–∞–∑; –≤–æ–∑–¥—É—Ö; –¥—É—Ö; —ç–Ω–µ—Ä–≥–∏—è —Ü–∏; –≥–Ω–µ–≤ [22√ó]
```

---
