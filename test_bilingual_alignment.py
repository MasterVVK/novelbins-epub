#!/usr/bin/env python3
"""
Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ´Ğ²ÑƒÑĞ·Ñ‹Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ‹Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ°
"""

import sys
sys.path.insert(0, 'web_app')

from web_app.app.utils.text_alignment import BilingualTextAligner


def test_sentence_splitting():
    """Ğ¢ĞµÑÑ‚ Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ñ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ"""

    print("=" * 70)
    print("Ğ¢Ğ•Ğ¡Ğ¢: Ğ Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ° Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ")
    print("=" * 70)

    # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°
    russian_text = """Ğ­Ñ€ Ğ›ÑĞ½Ñ†Ğ·Ñ‹ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¾ Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼Ğ¸ Ğ³Ğ»Ğ°Ğ·Ğ°Ğ¼Ğ¸ ÑƒÑÑ‚Ğ°Ğ²Ğ¸Ğ»ÑÑ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ½Ğ° Ñ‡Ñ‘Ñ€Ğ½ÑƒÑ ĞºÑ€Ñ‹ÑˆÑƒ, ÑĞ»ĞµĞ¿Ğ»ĞµĞ½Ğ½ÑƒÑ Ğ¸Ğ· ÑĞ¾Ğ»Ğ¾Ğ¼Ñ‹ Ğ¸ Ğ³Ğ½Ğ¸Ğ»Ğ¾Ğ¹ Ğ³Ñ€ÑĞ·Ğ¸. ĞĞ° Ğ½Ñ‘Ğ¼ Ğ±Ñ‹Ğ»Ğ¾ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ğ´ĞµÑĞ»Ğ¾, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¸Ğ¾Ğ±Ñ€ĞµĞ»Ğ¾ Ñ‚Ñ‘Ğ¼Ğ½Ğ¾-Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğ¹ Ñ†Ğ²ĞµÑ‚. ĞĞ½Ğ¾ Ñ‚Ğ°Ğº Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ğ»Ğ¾ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ½ĞµĞ»ÑŒĞ·Ñ Ğ±Ñ‹Ğ»Ğ¾ Ñ€Ğ°Ğ·Ğ³Ğ»ÑĞ´ĞµÑ‚ÑŒ ĞµĞ³Ğ¾ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ²Ğ¸Ğ´. ĞÑ‚ Ğ½ĞµĞ³Ğ¾ Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ğ» ÑĞ»Ğ°Ğ±Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ… Ğ¿Ğ»ĞµÑĞµĞ½Ğ¸."""

    # ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°
    chinese_text = """ç¬¬ä¸€ç« å±±è¾¹å°æ‘ äºŒæ„£å­çå¤§ç€åŒçœ¼ï¼Œç›´ç›´æœ›ç€èŒ…è‰å’Œçƒ‚æ³¥ç³Šæˆçš„é»‘å±‹é¡¶ï¼Œèº«ä¸Šç›–ç€çš„æ—§æ£‰è¢«ï¼Œå·²å‘ˆæ·±é»„è‰²ï¼Œçœ‹ä¸å‡ºåŸæ¥çš„æœ¬æ¥é¢ç›®ï¼Œè¿˜è‹¥æœ‰è‹¥æ— çš„æ•£ç€æ·¡æ·¡çš„éœ‰å‘³ã€‚"""

    print("\nğŸ“ Ğ Ğ£Ğ¡Ğ¡ĞšĞ˜Ğ™ Ğ¢Ğ•ĞšĞ¡Ğ¢:")
    print("-" * 70)
    print(russian_text)

    print("\nğŸ”ª Ğ Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ:")
    ru_sentences = BilingualTextAligner.split_into_sentences(russian_text, 'ru')
    for i, sent in enumerate(ru_sentences, 1):
        print(f"{i}. {sent}")

    print("\n" + "=" * 70)
    print("\nğŸ“ ĞšĞ˜Ğ¢ĞĞ™Ğ¡ĞšĞ˜Ğ™ Ğ¢Ğ•ĞšĞ¡Ğ¢:")
    print("-" * 70)
    print(chinese_text)

    print("\nğŸ”ª Ğ Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ:")
    zh_sentences = BilingualTextAligner.split_into_sentences(chinese_text, 'zh')
    for i, sent in enumerate(zh_sentences, 1):
        print(f"{i}. {sent}")

    return ru_sentences, zh_sentences


def test_alignment():
    """Ğ¢ĞµÑÑ‚ Ğ²Ñ‹Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹"""

    print("\n" + "=" * 70)
    print("Ğ¢Ğ•Ğ¡Ğ¢: Ğ’Ñ‹Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ÑƒÑÑĞºĞ¸Ñ… Ğ¸ ĞºĞ¸Ñ‚Ğ°Ğ¹ÑĞºĞ¸Ñ… Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹")
    print("=" * 70)

    russian_text = """Ğ­Ñ€ Ğ›ÑĞ½Ñ†Ğ·Ñ‹ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¾ Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼Ğ¸ Ğ³Ğ»Ğ°Ğ·Ğ°Ğ¼Ğ¸ ÑƒÑÑ‚Ğ°Ğ²Ğ¸Ğ»ÑÑ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ½Ğ° Ñ‡Ñ‘Ñ€Ğ½ÑƒÑ ĞºÑ€Ñ‹ÑˆÑƒ, ÑĞ»ĞµĞ¿Ğ»ĞµĞ½Ğ½ÑƒÑ Ğ¸Ğ· ÑĞ¾Ğ»Ğ¾Ğ¼Ñ‹ Ğ¸ Ğ³Ğ½Ğ¸Ğ»Ğ¾Ğ¹ Ğ³Ñ€ÑĞ·Ğ¸. ĞĞ° Ğ½Ñ‘Ğ¼ Ğ±Ñ‹Ğ»Ğ¾ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ğ´ĞµÑĞ»Ğ¾, ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ¾Ğµ ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¸Ğ¾Ğ±Ñ€ĞµĞ»Ğ¾ Ñ‚Ñ‘Ğ¼Ğ½Ğ¾-Ğ¶Ñ‘Ğ»Ñ‚Ñ‹Ğ¹ Ñ†Ğ²ĞµÑ‚."""

    chinese_text = """äºŒæ„£å­çå¤§ç€åŒçœ¼ï¼Œç›´ç›´æœ›ç€èŒ…è‰å’Œçƒ‚æ³¥ç³Šæˆçš„é»‘å±‹é¡¶ã€‚èº«ä¸Šç›–ç€çš„æ—§æ£‰è¢«ï¼Œå·²å‘ˆæ·±é»„è‰²ã€‚"""

    aligned_pairs = BilingualTextAligner.align_sentences(russian_text, chinese_text)

    print("\nğŸ”— Ğ’Ñ‹Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ñ‹:")
    print("-" * 70)
    for i, (ru, zh) in enumerate(aligned_pairs, 1):
        print(f"\nĞŸĞ°Ñ€Ğ° {i}:")
        print(f"  RU: {ru}")
        print(f"  ZH: {zh}")

    return aligned_pairs


def test_epub_formatting():
    """Ğ¢ĞµÑÑ‚ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ EPUB"""

    print("\n" + "=" * 70)
    print("Ğ¢Ğ•Ğ¡Ğ¢: Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ EPUB")
    print("=" * 70)

    russian_text = """Ğ­Ñ€ Ğ›ÑĞ½Ñ†Ğ·Ñ‹ ÑˆĞ¸Ñ€Ğ¾ĞºĞ¾ Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ñ‹Ğ¼Ğ¸ Ğ³Ğ»Ğ°Ğ·Ğ°Ğ¼Ğ¸ ÑƒÑÑ‚Ğ°Ğ²Ğ¸Ğ»ÑÑ Ğ¿Ñ€ÑĞ¼Ğ¾ Ğ½Ğ° Ñ‡Ñ‘Ñ€Ğ½ÑƒÑ ĞºÑ€Ñ‹ÑˆÑƒ, ÑĞ»ĞµĞ¿Ğ»ĞµĞ½Ğ½ÑƒÑ Ğ¸Ğ· ÑĞ¾Ğ»Ğ¾Ğ¼Ñ‹ Ğ¸ Ğ³Ğ½Ğ¸Ğ»Ğ¾Ğ¹ Ğ³Ñ€ÑĞ·Ğ¸. ĞĞ° Ğ½Ñ‘Ğ¼ Ğ±Ñ‹Ğ»Ğ¾ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ Ğ²Ğ°Ñ‚Ğ½Ğ¾Ğµ Ğ¾Ğ´ĞµÑĞ»Ğ¾."""

    chinese_text = """äºŒæ„£å­çå¤§ç€åŒçœ¼ï¼Œç›´ç›´æœ›ç€èŒ…è‰å’Œçƒ‚æ³¥ç³Šæˆçš„é»‘å±‹é¡¶ã€‚èº«ä¸Šç›–ç€çš„æ—§æ£‰è¢«ã€‚"""

    aligned_pairs = BilingualTextAligner.align_sentences(russian_text, chinese_text)

    # Ğ§ĞµÑ€ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
    print("\nğŸ“– Ğ ĞµĞ¶Ğ¸Ğ¼: Ğ§Ğ•Ğ Ğ•Ğ”ĞĞ’ĞĞĞ˜Ğ• (alternating)")
    print("-" * 70)
    html_alternating = BilingualTextAligner.format_for_epub(
        aligned_pairs,
        mode='sentence',
        style='alternating'
    )
    print(html_alternating)

    # ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
    print("\nğŸ“– Ğ ĞµĞ¶Ğ¸Ğ¼: ĞŸĞĞ ĞĞ›Ğ›Ğ•Ğ›Ğ¬ĞĞ«Ğ™ (parallel)")
    print("-" * 70)
    html_parallel = BilingualTextAligner.format_for_epub(
        aligned_pairs,
        mode='sentence',
        style='parallel'
    )
    print(html_parallel)


def main():
    """Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ"""

    print("\n")
    print("â•”" + "=" * 68 + "â•—")
    print("â•‘" + " " * 15 + "Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ• Ğ”Ğ’Ğ£Ğ¯Ğ—Ğ«Ğ§ĞĞĞ“Ğ Ğ’Ğ«Ğ ĞĞ’ĞĞ˜Ğ’ĞĞĞ˜Ğ¯" + " " * 15 + "â•‘")
    print("â•š" + "=" * 68 + "â•")

    try:
        # Ğ¢ĞµÑÑ‚ 1: Ğ Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
        test_sentence_splitting()

        # Ğ¢ĞµÑÑ‚ 2: Ğ’Ñ‹Ñ€Ğ°Ğ²Ğ½Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ
        test_alignment()

        # Ğ¢ĞµÑÑ‚ 3: Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ»Ñ EPUB
        test_epub_formatting()

        print("\n" + "=" * 70)
        print("âœ… Ğ’Ğ¡Ğ• Ğ¢Ğ•Ğ¡Ğ¢Ğ« ĞŸĞ ĞĞ™Ğ”Ğ•ĞĞ« Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ!")
        print("=" * 70)
        print("\nĞ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ:")
        print("1. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ web_app: python web_app/run.py")
        print("2. ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ½Ğ¾Ğ²ĞµĞ»Ğ»Ñ‹")
        print("3. ĞĞ°Ğ¶Ğ°Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ 'Ğ”Ğ²ÑƒÑĞ·Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ EPUB (RU + ä¸­æ–‡)'")
        print("4. Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ EPUB Ñ„Ğ°Ğ¹Ğ»")
        print()

    except Exception as e:
        print("\n" + "=" * 70)
        print("âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ ĞŸĞ Ğ˜ Ğ¢Ğ•Ğ¡Ğ¢Ğ˜Ğ ĞĞ’ĞĞĞ˜Ğ˜!")
        print("=" * 70)
        print(f"\nĞÑˆĞ¸Ğ±ĞºĞ°: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)


if __name__ == '__main__':
    main()
