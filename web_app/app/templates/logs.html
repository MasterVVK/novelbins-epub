{% extends "base.html" %}

{% block title %}–õ–æ–≥–∏ - Novel Translator{% endblock %}
{% block page_title %}–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã{% endblock %}

{% block extra_head %}
<script src="{{ url_for('static', filename='js/status_colors.js') }}?v=2"></script>
{% endblock %}

{% block content %}
<div class="row">
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="col-md-12 mb-4">
        <div class="row">
            <div class="col-md-2">
                <div class="card stat-card clickable-card" onclick="applyQuickFilter('all')" style="cursor: pointer;" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏">
                    <div class="card-body text-center">
                        <h5 class="card-title" id="total-logs">-</h5>
                        <p class="card-text">–í—Å–µ–≥–æ –ª–æ–≥–æ–≤</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card clickable-card" onclick="applyQuickFilter('error')" style="cursor: pointer;" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏">
                    <div class="card-body text-center">
                        <h5 class="card-title text-danger" id="error-logs">-</h5>
                        <p class="card-text">–û—à–∏–±–∫–∏</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card clickable-card" onclick="applyQuickFilter('warning')" style="cursor: pointer;" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è">
                    <div class="card-body text-center">
                        <h5 class="card-title text-warning" id="warning-logs">-</h5>
                        <p class="card-text">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card clickable-card" onclick="applyQuickFilter('info')" style="cursor: pointer;" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ª–æ–≥–∏">
                    <div class="card-body text-center">
                        <h5 class="card-title text-info" id="info-logs">-</h5>
                        <p class="card-text">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card clickable-card" onclick="applyQuickFilter('recent')" style="cursor: pointer;" title="–ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞">
                    <div class="card-body text-center">
                        <h5 class="card-title text-success" id="recent-logs">-</h5>
                        <p class="card-text">–ó–∞ 24 —á–∞—Å–∞</p>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="card stat-card">
                    <div class="card-body text-center">
                        <button class="btn btn-outline-light btn-sm" onclick="clearOldLogs()">
                            <i class="bi bi-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div class="col-md-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-funnel"></i> –§–∏–ª—å—Ç—Ä—ã
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-2">
                        <label for="level-filter" class="form-label">–£—Ä–æ–≤–µ–Ω—å</label>
                        <select class="form-select" id="level-filter">
                            <option value="">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
                            <option value="ERROR">–û—à–∏–±–∫–∏</option>
                            <option value="WARNING">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</option>
                            <option value="INFO">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</option>
                            <option value="DEBUG">–û—Ç–ª–∞–¥–∫–∞</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="task-filter" class="form-label">–ó–∞–¥–∞—á–∞</label>
                        <select class="form-select" id="task-filter">
                            <option value="">–í—Å–µ –∑–∞–¥–∞—á–∏</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="novel-filter" class="form-label">–ù–æ–≤–µ–ª–ª–∞</label>
                        <select class="form-select" id="novel-filter">
                            <option value="">–í—Å–µ –Ω–æ–≤–µ–ª–ª—ã</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="hours-filter" class="form-label">–ß–∞—Å—ã</label>
                        <select class="form-select" id="hours-filter">
                            <option value="1">1 —á–∞—Å</option>
                            <option value="6">6 —á–∞—Å–æ–≤</option>
                            <option value="24" selected>24 —á–∞—Å–∞</option>
                            <option value="168">7 –¥–Ω–µ–π</option>
                            <option value="720">30 –¥–Ω–µ–π</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label for="limit-filter" class="form-label">–õ–∏–º–∏—Ç</label>
                        <select class="form-select" id="limit-filter">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="200">200</option>
                            <option value="500">500</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">&nbsp;</label>
                        <div>
                            <button class="btn btn-primary" onclick="loadLogs()">
                                <i class="bi bi-search"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                            </button>
                            <button class="btn btn-outline-secondary" onclick="resetFilters()">
                                <i class="bi bi-arrow-clockwise"></i> –°–±—Ä–æ—Å
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –õ–æ–≥–∏ -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="bi bi-list-ul"></i> –õ–æ–≥–∏
                    <span class="badge bg-primary ms-2" id="logs-count">0</span>
                </h5>
                <div>
                    <button class="btn btn-outline-success btn-sm" onclick="toggleAutoRefresh()">
                        <i class="bi bi-play-circle" id="auto-refresh-icon"></i>
                        <span id="auto-refresh-text">–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                    </button>
                    <button class="btn btn-outline-primary btn-sm" onclick="loadLogs()">
                        <i class="bi bi-arrow-clockwise"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="logs-container" style="max-height: 600px; overflow-y: auto;">
                    <div class="text-center py-5">
                        <i class="bi bi-hourglass-split text-muted fs-1"></i>
                        <h4 class="text-muted mt-3">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let autoRefreshInterval = null;
let isAutoRefreshEnabled = false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    loadStats();
    loadLogs();
    loadFilters();
    setupWebSocket();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á—Ç–æ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ
    const container = document.getElementById('logs-container');
    const notice = document.createElement('div');
    notice.id = 'pause-notice';
    notice.className = 'alert alert-warning mb-3';
    notice.innerHTML = `
        <i class="bi bi-pause-circle-fill"></i>
        <strong>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ</strong> - –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ" –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    `;
    container.parentElement.insertBefore(notice, container);
});

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function loadStats() {
    fetch('/api/logs/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('total-logs').textContent = data.stats.total;
                document.getElementById('error-logs').textContent = data.stats.errors;
                document.getElementById('warning-logs').textContent = data.stats.warnings;
                document.getElementById('info-logs').textContent = data.stats.info;
                document.getElementById('recent-logs').textContent = data.stats.recent_24h;
            }
        })
        .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error));
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤
function loadLogs() {
    const level = document.getElementById('level-filter').value;
    const taskId = document.getElementById('task-filter').value;
    const novelId = document.getElementById('novel-filter').value;
    const hours = document.getElementById('hours-filter').value;
    const limit = document.getElementById('limit-filter').value;

    let url = '/api/logs/recent?hours=' + hours + '&limit=' + limit;
    if (level) url += '&level=' + level;
    if (taskId) url += '&task_id=' + taskId;
    if (novelId) url += '&novel_id=' + novelId;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayLogs(data.logs);
                document.getElementById('logs-count').textContent = data.count;
            } else {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', data.error);
            }
        })
        .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error));
}

// –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–≥–æ–≤
function displayLogs(logs) {
    const container = document.getElementById('logs-container');
    
    if (logs.length === 0) {
        container.innerHTML = `
            <div class="text-center py-5">
                <i class="bi bi-inbox text-muted fs-1"></i>
                <h4 class="text-muted mt-3">–õ–æ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                <p class="text-muted">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
            </div>
        `;
        return;
    }

    const logsHtml = logs.map(log => {
        const levelClass = log.is_error ? 'text-danger' : 
                          log.is_warning ? 'text-warning' : 
                          log.is_info ? 'text-info' : 'text-muted';
        
        const levelIcon = log.is_error ? 'bi-exclamation-triangle' :
                         log.is_warning ? 'bi-exclamation-circle' :
                         log.is_info ? 'bi-info-circle' : 'bi-dash-circle';
        
        const time = new Date(log.created_at).toLocaleString('ru-RU');
        
        return `
            <div class="log-entry border-bottom py-2 ${levelClass}">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center mb-1">
                            <i class="bi ${levelIcon} me-2"></i>
                            <span class="badge bg-${StatusColors.getLogLevelColor(log.level)} me-2">${log.level}</span>
                            <small class="text-muted">${time}</small>
                        </div>
                        <div class="log-message">${escapeHtml(log.message)}</div>
                        ${log.module ? `<small class="text-muted">–ú–æ–¥—É–ª—å: ${log.module}</small>` : ''}
                        ${log.function ? `<small class="text-muted ms-2">–§—É–Ω–∫—Ü–∏—è: ${log.function}</small>` : ''}
                    </div>
                    <div class="ms-2">
                        ${log.task_id ? `<span class="badge bg-secondary me-1">–ó–∞–¥–∞—á–∞ ${log.task_id}</span>` : ''}
                        ${log.novel_id ? `<span class="badge bg-primary me-1">–ù–æ–≤–µ–ª–ª–∞ ${log.novel_id}</span>` : ''}
                        ${log.chapter_id ? `<span class="badge bg-success">–ì–ª–∞–≤–∞ ${log.chapter_id}</span>` : ''}
                    </div>
                </div>
            </div>
        `;
    }).join('');

    container.innerHTML = logsHtml;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
function loadFilters() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á
        fetch('/api/tasks')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.tasks) {
                    const taskFilter = document.getElementById('task-filter');
                    data.tasks.forEach(task => {
                        if (task && task.id) {
                            const option = document.createElement('option');
                            option.value = task.id;
                            option.textContent = `–ó–∞–¥–∞—á–∞ ${task.id} (${task.task_type || 'unknown'})`;
                            taskFilter.appendChild(option);
                        }
                    });
                }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error));

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–µ–ª–ª
        fetch('/api/novels')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.novels) {
                    const novelFilter = document.getElementById('novel-filter');
                    data.novels.forEach(novel => {
                        if (novel && novel.id) {
                            const option = document.createElement('option');
                            option.value = novel.id;
                            option.textContent = novel.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                            novelFilter.appendChild(option);
                        }
                    });
                }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–µ–ª–ª:', error));
}

// –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
function resetFilters() {
    document.getElementById('level-filter').value = '';
    document.getElementById('task-filter').value = '';
    document.getElementById('novel-filter').value = '';
    document.getElementById('hours-filter').value = '24';
    document.getElementById('limit-filter').value = '100';
    loadLogs();
}

// –ë—ã—Å—Ç—Ä–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª–∏–∫—É –Ω–∞ –ø–ª–∞—à–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function applyQuickFilter(filterType) {
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã
    document.getElementById('task-filter').value = '';
    document.getElementById('novel-filter').value = '';

    switch(filterType) {
        case 'all':
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ª–æ–≥–∏ (—Å–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤)
            document.getElementById('level-filter').value = '';
            document.getElementById('hours-filter').value = '720'; // 30 –¥–Ω–µ–π
            document.getElementById('limit-filter').value = '500';
            break;
        case 'error':
            // –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
            document.getElementById('level-filter').value = 'ERROR';
            document.getElementById('hours-filter').value = '720'; // 30 –¥–Ω–µ–π (—á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –æ—à–∏–±–∫–∏)
            document.getElementById('limit-filter').value = '200';
            break;
        case 'warning':
            // –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            document.getElementById('level-filter').value = 'WARNING';
            document.getElementById('hours-filter').value = '720'; // 30 –¥–Ω–µ–π
            document.getElementById('limit-filter').value = '200';
            break;
        case 'info':
            // –¢–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ
            document.getElementById('level-filter').value = 'INFO';
            document.getElementById('hours-filter').value = '168'; // 7 –¥–Ω–µ–π
            document.getElementById('limit-filter').value = '200';
            break;
        case 'recent':
            // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
            document.getElementById('level-filter').value = '';
            document.getElementById('hours-filter').value = '24';
            document.getElementById('limit-filter').value = '100';
            break;
    }

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    loadLogs();

    // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ª–æ–≥–∞–º
    document.getElementById('logs-container').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
    });
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
function toggleAutoRefresh() {
    if (isAutoRefreshEnabled) {
        clearInterval(autoRefreshInterval);
        isAutoRefreshEnabled = false;
        document.getElementById('auto-refresh-icon').className = 'bi bi-play-circle';
        document.getElementById('auto-refresh-text').textContent = '–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const container = document.getElementById('logs-container');
        const notice = document.createElement('div');
        notice.id = 'pause-notice';
        notice.className = 'alert alert-success mb-3';
        notice.innerHTML = `
            <i class="bi bi-check-circle-fill"></i>
            <strong>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</strong> - –º–æ–∂–Ω–æ —Å–ø–æ–∫–æ–π–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
        `;
        container.parentElement.insertBefore(notice, container);
    } else {
        autoRefreshInterval = setInterval(loadLogs, 5000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        isAutoRefreshEnabled = true;
        document.getElementById('auto-refresh-icon').className = 'bi bi-pause-circle';
        document.getElementById('auto-refresh-text').textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ';

        // –£–±–∏—Ä–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        const notice = document.getElementById('pause-notice');
        if (notice) notice.remove();
    }
}

// –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
function clearOldLogs() {
    if (!confirm('–£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π?')) return;
    
    fetch('/api/logs/clear', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ days: 30 })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(`–£–¥–∞–ª–µ–Ω–æ ${data.deleted_count} —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤`);
            loadStats();
            loadLogs();
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤:', error);
        alert('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ª–æ–≥–æ–≤');
    });
}

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WebSocket
function setupWebSocket() {
    socket.on('log_entry', function(logData) {
        // –ï—Å–ª–∏ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ, –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ª–æ–≥–∏
        if (!isAutoRefreshEnabled) {
            return;
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ª–æ–≥ –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
        const container = document.getElementById('logs-container');
        const logHtml = `
            <div class="log-entry border-bottom py-2 ${logData.is_error ? 'text-danger' : logData.is_warning ? 'text-warning' : 'text-info'}" style="animation: fadeIn 0.5s;">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <div class="d-flex align-items-center mb-1">
                            <i class="bi ${logData.is_error ? 'bi-exclamation-triangle' : logData.is_warning ? 'bi-exclamation-circle' : 'bi-info-circle'} me-2"></i>
                            <span class="badge bg-${StatusColors.getLogLevelColor(logData.level)} me-2">${logData.level}</span>
                            <small class="text-muted">${new Date(logData.created_at).toLocaleString('ru-RU')}</small>
                        </div>
                        <div class="log-message">${escapeHtml(logData.message)}</div>
                    </div>
                </div>
            </div>
        `;

        container.insertAdjacentHTML('afterbegin', logHtml);

        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏, –µ—Å–ª–∏ –∏—Ö —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
        const logEntries = container.querySelectorAll('.log-entry');
        if (logEntries.length > 100) {
            logEntries[logEntries.length - 1].remove();
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
        const currentCount = parseInt(document.getElementById('logs-count').textContent);
        document.getElementById('logs-count').textContent = currentCount + 1;
    });
}

// –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}
</script>

<style>
.log-entry {
    transition: background-color 0.3s ease;
}

.log-entry:hover {
    background-color: rgba(0,0,0,0.05);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.clickable-card {
    transition: all 0.3s ease;
    position: relative;
}

.clickable-card:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
}

.clickable-card:active {
    transform: translateY(-2px) scale(1.01);
}

.clickable-card::after {
    content: 'üëÜ';
    position: absolute;
    top: 5px;
    right: 10px;
    font-size: 16px;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.clickable-card:hover::after {
    opacity: 0.7;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %} 