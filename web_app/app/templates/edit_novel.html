{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å {{ novel.title }} - Novel Translator{% endblock %}
{% block page_title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å {{ novel.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-pencil-square"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–µ–ª–ª—É
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–µ–ª–ª—ã *</label>
                        <input type="text" class="form-control" id="title" name="title" value="{{ novel.title }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="original_title" class="form-label">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-control" id="original_title" name="original_title" value="{{ novel.original_title or '' }}">
                        <div class="form-text">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —è–∑—ã–∫–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="author" class="form-label">–ê–≤—Ç–æ—Ä</label>
                        <input type="text" class="form-control" id="author" name="author" value="{{ novel.author or '' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="source_url" class="form-label" id="source_url_label">
                            {% if novel.source_type == 'epub' %}
                                –ü—É—Ç—å –∫ EPUB —Ñ–∞–π–ª—É *
                            {% else %}
                                URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ *
                            {% endif %}
                        </label>
                        <input type="{% if novel.source_type == 'epub' %}text{% else %}url{% endif %}" 
                               class="form-control" id="source_url" name="source_url" 
                               value="{{ novel.source_url }}" required
                               placeholder="{% if novel.source_type == 'epub' %}–ü—É—Ç—å –∫ EPUB —Ñ–∞–π–ª—É{% else %}URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞{% endif %}">
                        <div class="form-text" id="source_url_help">
                            {% if novel.source_type == 'epub' %}
                                –£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ EPUB —Ñ–∞–π–ª—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                            {% else %}
                                –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ–≤–µ–ª–ª—ã
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="source_type" class="form-label">–¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞</label>
                        <select class="form-select" id="source_type" name="source_type">
                            {% for source in available_sources %}
                            <option value="{{ source.id }}" 
                                    data-description="{{ source.description }}" 
                                    data-languages="{{ source.supported_languages|join(',') }}"
                                    data-example="{{ source.example_url }}"
                                    {{ 'selected' if novel.source_type == source.id else '' }}>
                                {{ source.name }}
                            </option>
                            {% endfor %}
                            <option value="novelbins" {{ 'selected' if novel.source_type == 'novelbins' else '' }}>NovelBins (Legacy)</option>
                            <option value="webnovel" {{ 'selected' if novel.source_type == 'webnovel' else '' }}>WebNovel (Legacy)</option>
                            <option value="other" {{ 'selected' if novel.source_type == 'other' else '' }}>–î—Ä—É–≥–æ–π</option>
                        </select>
                        <div class="form-text">
                            <span id="source-description">{{ novel.source_type }} - –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è –≤–∞—à–µ–π –Ω–æ–≤–µ–ª–ª—ã</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="prompt_template_id" class="form-label">–®–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞</label>
                        <select class="form-select" id="prompt_template_id" name="prompt_template_id">
                            <option value="none" {{ 'selected' if not novel.prompt_template_id else '' }}>–ë–µ–∑ —à–∞–±–ª–æ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                            {% for template in prompt_templates %}
                            <option value="{{ template.id }}" {{ 'selected' if novel.prompt_template_id == template.id else '' }}>
                                {{ template.name }} ({{ template.category }})
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —ç—Ç–æ–π –Ω–æ–≤–µ–ª–ª—ã</div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="max_chapters" class="form-label">–ú–∞–∫—Å–∏–º—É–º –≥–ª–∞–≤</label>
                                <!-- –û—Ç–ª–∞–¥–∫–∞: max_chapters = {{ novel.config.max_chapters if novel.config and novel.config.max_chapters else '–ù–ï–¢ –ó–ù–ê–ß–ï–ù–ò–Ø' }} -->
                                <div class="input-group">
                                    <input type="number" class="form-control" id="max_chapters" name="max_chapters" 
                                           value="{{ novel.config.max_chapters if novel.config and novel.config.max_chapters else 100 }}" 
                                           min="1" max="1000" 
                                           {{ 'disabled style="background-color: #e9ecef;"' if novel.config and novel.config.all_chapters else '' }}>
                                </div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="all_chapters" name="all_chapters" value="true"
                                           {{ 'checked' if novel.config and novel.config.all_chapters else '' }}>
                                    <label class="form-check-label" for="all_chapters">
                                        –í—Å–µ –≥–ª–∞–≤—ã (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
                                    </label>
                                </div>
                                <div class="form-text">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {{ novel.config.max_chapters if novel.config and novel.config.max_chapters else '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="start_chapter" class="form-label">–ù–∞—á–∞—Ç—å —Å –≥–ª–∞–≤—ã</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="start_chapter" name="start_chapter" 
                                           value="{{ novel.config.start_chapter if novel.config and novel.config.start_chapter else 1 }}" 
                                           min="0" max="1000">
                                    <span class="input-group-text">
                                        <i class="bi bi-play-fill"></i>
                                    </span>
                                </div>
                                <div class="form-text">
                                    {% if novel.source_type == 'epub' %}
                                        –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ –≥–ª–∞–≤—ã (Cover, Table of Contents). –û–±—ã—á–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å —Å –≥–ª–∞–≤—ã 1 –∏–ª–∏ 3.
                                    {% else %}
                                        –ù–æ–º–µ—Ä –≥–ª–∞–≤—ã, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ (1 = –ø–µ—Ä–≤–∞—è –≥–ª–∞–≤–∞)
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="request_delay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫)</label>
                                <input type="number" class="form-control" id="request_delay" name="request_delay" 
                                       value="{{ novel.config.request_delay if novel.config and novel.config.request_delay else 1.0 }}" 
                                       min="0.1" max="10" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <label for="filter_text" class="form-label">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ</label>
                                <textarea class="form-control" id="filter_text" name="filter_text" rows="3" 
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä)">{{ novel.config.filter_text if novel.config and novel.config.filter_text else '' }}</textarea>
                                <div class="form-text">
                                    –¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—Ç—å—Å—è –∏–∑ –≥–ª–∞–≤ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ. 
                                    –ù–∞–ø—Ä–∏–º–µ—Ä: "Txt,Epub,Mobi www.qinkan.net" –∏–ª–∏ —Ä–µ–∫–ª–∞–º–Ω—ã–µ —Å—Å—ã–ª–∫–∏.
                                    –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞</h6>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–ª–∞–≤–∞–º:</strong>
                        <ol class="mb-0 mt-2">
                            <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç–µ-–∏—Å—Ç–æ—á–Ω–∏–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Qidian.com)</li>
                            <li>–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12) ‚Üí Network</li>
                            <li>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ Cookie –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ cookies –≤ –ø–æ–ª–µ –Ω–∏–∂–µ</li>
                        </ol>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="auth_enabled" name="auth_enabled" value="true"
                                   {{ 'checked' if novel.auth_enabled else '' }}>
                            <label class="form-check-label" for="auth_enabled">
                                <strong>–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</strong>
                            </label>
                        </div>
                        <div class="form-text">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cookies –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–ª–∞–≤–∞–º</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="auth_cookies" class="form-label">Cookies –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</label>
                        <textarea class="form-control" id="auth_cookies" name="auth_cookies" rows="3" 
                                  placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞...">{{ novel.auth_cookies or '' }}</textarea>
                        <div class="form-text">
                            <strong>–ü—Ä–∏–º–µ—Ä:</strong> <code>sessionid=abc123; user_id=456; token=xyz789</code><br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                            {% if novel.auth_enabled and novel.auth_cookies %}
                                <span class="text-success">‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞</span>
                            {% else %}
                                <span class="text-muted">‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">üíé VIP –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h6>
                    
                    <div class="alert alert-success">
                        <i class="bi bi-star-fill"></i>
                        <strong>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ VIP/–ø–ª–∞—Ç–Ω—ã–º –≥–ª–∞–≤–∞–º:</strong>
                        <ol class="mb-0 mt-2">
                            <li>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç–µ –∏ <strong>–∫—É–ø–∏—Ç–µ/–ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å</strong> –Ω–∞ VIP –∫–æ–Ω—Ç–µ–Ω—Ç</li>
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ VIP –≥–ª–∞–≤—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ (—É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞)</li>
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12) ‚Üí Network</li>
                            <li>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ <strong>VIP cookies</strong> –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ VIP cookies –≤ –ø–æ–ª–µ –Ω–∏–∂–µ</li>
                        </ol>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="vip_cookies_enabled" name="vip_cookies_enabled" value="true"
                                   {{ 'checked' if novel.vip_cookies_enabled else '' }}>
                            <label class="form-check-label" for="vip_cookies_enabled">
                                <strong>–í–∫–ª—é—á–∏—Ç—å VIP –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</strong>
                            </label>
                        </div>
                        <div class="form-text">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ cookies –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–ª–∞—Ç–Ω—ã–º –≥–ª–∞–≤–∞–º</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="vip_cookies" class="form-label">VIP Cookies –¥–ª—è –ø—Ä–µ–º–∏—É–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞</label>
                        <textarea class="form-control" id="vip_cookies" name="vip_cookies" rows="3" 
                                  placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ VIP cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞...">{{ novel.vip_cookies or '' }}</textarea>
                        <div class="form-text">
                            <strong>–í–∞–∂–Ω–æ:</strong> –î–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å <code>w_tsfp</code>, <code>_csrfToken</code> –∏ –¥—Ä—É–≥–∏–µ VIP –ø–∞—Ä–∞–º–µ—Ç—Ä—ã<br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                            {% if novel.vip_cookies_enabled and novel.vip_cookies %}
                                <span class="text-success">‚úÖ VIP –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞</span>
                            {% else %}
                                <span class="text-muted">‚ùå VIP –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">üåê SOCKS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫</h6>
                    
                    <div class="alert alert-warning">
                        <i class="bi bi-shield-exclamation"></i>
                        <strong>–î–ª—è –æ–±—Ö–æ–¥–∞ WAF –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:</strong>
                        <ol class="mb-0 mt-2">
                            <li>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SOCKS5 –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ VPN)</li>
                            <li>–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –ø—Ä–æ–∫—Å–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ <code>host:port</code></li>
                            <li>–ü—Ä–æ–∫—Å–∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π –Ω–æ–≤–µ–ª–ª—ã</li>
                            <li>–û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∫–∏—Ç–∞–π—Å–∫–∏—Ö —Å–∞–π—Ç–æ–≤ (Qidian, WebNovel)</li>
                        </ol>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="proxy_enabled" name="proxy_enabled" value="true"
                                   {{ 'checked' if novel.proxy_enabled else '' }}>
                            <label class="form-check-label" for="proxy_enabled">
                                <strong>–í–∫–ª—é—á–∏—Ç—å SOCKS –ø—Ä–æ–∫—Å–∏</strong>
                            </label>
                        </div>
                        <div class="form-text">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SOCKS –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –≥–µ–æ–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ WAF</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="socks_proxy" class="form-label">SOCKS –ø—Ä–æ–∫—Å–∏ (host:port)</label>
                        <input type="text" class="form-control" id="socks_proxy" name="socks_proxy" 
                               value="{{ novel.socks_proxy or '' }}" 
                               placeholder="192.168.1.100:1080">
                        <div class="form-text">
                            <strong>–ü—Ä–∏–º–µ—Ä:</strong> <code>192.168.0.61:1080</code> –∏–ª–∏ <code>proxy.example.com:1080</code><br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                            {% if novel.proxy_enabled and novel.socks_proxy %}
                                <span class="text-success">‚úÖ SOCKS –ø—Ä–æ–∫—Å–∏ –∞–∫—Ç–∏–≤–µ–Ω: {{ novel.socks_proxy }}</span>
                            {% else %}
                                <span class="text-muted">‚ùå –ü—Ä–æ–∫—Å–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="translation_model" class="form-label">–ú–æ–¥–µ–ª—å –ø–µ—Ä–µ–≤–æ–¥–∞</label>
                                <select class="form-select" id="translation_model" name="translation_model">
                                    {% if ai_models %}
                                        {% for model in ai_models %}
                                            <option value="{{ model.model_id }}"
                                                    data-provider="{{ model.provider }}"
                                                    data-name="{{ model.name }}"
                                                    {{ 'selected' if novel.config and novel.config.translation_model == model.model_id else '' }}>
                                                {{ model.name }} ({{ model.provider|upper }})
                                                {% if model.is_default %}[–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é]{% endif %}
                                            </option>
                                        {% endfor %}
                                    {% else %}
                                        <!-- Fallback –Ω–∞ —Å—Ç–∞—Ä—ã–µ –æ–ø—Ü–∏–∏ –µ—Å–ª–∏ –º–æ–¥–µ–ª–µ–π –Ω–µ—Ç –≤ –±–∞–∑–µ -->
                                        <option value="gemini-2.5-flash"
                                                {{ 'selected' if not novel.config or novel.config.translation_model == 'gemini-2.5-flash' else '' }}>
                                            Gemini 2.5 Flash
                                        </option>
                                        <option value="gemini-2.5-pro"
                                                {{ 'selected' if novel.config and novel.config.translation_model == 'gemini-2.5-pro' else '' }}>
                                            Gemini 2.5 Pro
                                        </option>
                                        <option value="gpt-4o"
                                                {{ 'selected' if novel.config and novel.config.translation_model == 'gpt-4o' else '' }}>
                                            GPT-4o
                                        </option>
                                        <option value="claude-3-5-sonnet"
                                                {{ 'selected' if novel.config and novel.config.translation_model == 'claude-3-5-sonnet' else '' }}>
                                            Claude 3.5 Sonnet
                                        </option>
                                    {% endif %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="translation_temperature" class="form-label">–¢–æ—á–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞</label>
                                <input type="number" class="form-control" id="translation_temperature" name="translation_temperature" 
                                       value="{{ novel.config.translation_temperature if novel.config and novel.config.translation_temperature else 0.1 }}" 
                                       min="0" max="1" step="0.1">
                                <div class="form-text">–¢–æ—á–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ (0-1). 0 = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, 1 = –±–æ–ª–µ–µ —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">üìö –ù–∞—Å—Ç—Ä–æ–π–∫–∏ EPUB –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="epub_add_chapter_prefix" class="form-label">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞ –∫ –≥–ª–∞–≤–∞–º</label>
                                <select class="form-select" id="epub_add_chapter_prefix" name="epub_add_chapter_prefix">
                                    <option value="auto" {{ 'selected' if not novel.epub_add_chapter_prefix or novel.epub_add_chapter_prefix == 'auto' else '' }}>
                                        –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—É–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
                                    </option>
                                    <option value="always" {{ 'selected' if novel.epub_add_chapter_prefix == 'always' else '' }}>
                                        –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å
                                    </option>
                                    <option value="never" {{ 'selected' if novel.epub_add_chapter_prefix == 'never' else '' }}>
                                        –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å
                                    </option>
                                </select>
                                <div class="form-text">
                                    <strong>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:</strong> –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏<br>
                                    <strong>–í—Å–µ–≥–¥–∞:</strong> –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å "–ì–ª–∞–≤–∞ X:"<br>
                                    <strong>–ù–∏–∫–æ–≥–¥–∞:</strong> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–∫ –µ—Å—Ç—å
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="epub_chapter_prefix_text" class="form-label">–¢–µ–∫—Å—Ç –ø—Ä–µ—Ñ–∏–∫—Å–∞</label>
                                <input type="text" class="form-control" id="epub_chapter_prefix_text" name="epub_chapter_prefix_text" 
                                       value="{{ novel.epub_chapter_prefix_text or '–ì–ª–∞–≤–∞' }}" 
                                       placeholder="–ì–ª–∞–≤–∞">
                                <div class="form-text">
                                    –¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –ø—Ä–µ—Ñ–∏–∫—Å–µ.<br>
                                    –ù–∞–ø—Ä–∏–º–µ—Ä: "–ì–ª–∞–≤–∞", "Chapter", "–ß–∞—Å—Ç—å" –∏ —Ç.–¥.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editing_quality_mode" class="form-label">–†–µ–∂–∏–º –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                                <select class="form-select" id="editing_quality_mode" name="editing_quality_mode">
                                    <option value="fast" {{ 'selected' if not novel.config or novel.config.editing_quality_mode == 'fast' else '' }}>
                                        –ë—ã—Å—Ç—Ä–æ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.5)
                                    </option>
                                    <option value="balanced" {{ 'selected' if novel.config and novel.config.editing_quality_mode == 'balanced' else '' }}>
                                        –ë–∞–ª–∞–Ω—Å (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.7)
                                    </option>
                                    <option value="quality" {{ 'selected' if novel.config and novel.config.editing_quality_mode == 'quality' else '' }}>
                                        –ö–∞—á–µ—Å—Ç–≤–æ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.9)
                                    </option>
                                </select>
                                <div class="form-text">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editing_temperature_display" class="form-label">–¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                                <input type="text" class="form-control" id="editing_temperature_display" readonly 
                                       value="{{ novel.config.editing_temperature if novel.config and novel.config.editing_temperature else '0.7' }}">
                                <div class="form-text">–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –∫–∞—á–µ—Å—Ç–≤–∞</div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editing_threads" class="form-label">
                                    –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ —Ä–µ–¥–∞–∫—Ç—É—Ä—ã
                                    <i class="bi bi-info-circle" data-bs-toggle="tooltip" title="–°–∫–æ–ª—å–∫–æ –≥–ª–∞–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2-5 –¥–ª—è Ollama)"></i>
                                </label>
                                <input type="number" class="form-control" id="editing_threads" name="editing_threads"
                                       min="1" max="10" step="1"
                                       value="{{ novel.config.editing_threads if novel.config and novel.config.editing_threads else 3 }}">
                                <div class="form-text">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3 –ø–æ—Ç–æ–∫–∞. –ë–æ–ª—å—à–µ –ø–æ—Ç–æ–∫–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –≤—ã—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.novel_detail', novel_id=novel.id) }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—è source_url –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
document.getElementById('source_type').addEventListener('change', function() {
    const sourceType = this.value;
    const sourceUrlInput = document.getElementById('source_url');
    const sourceUrlLabel = document.getElementById('source_url_label');
    const sourceUrlHelp = document.getElementById('source_url_help');
    
    if (sourceType === 'epub') {
        sourceUrlInput.type = 'text';
        sourceUrlInput.placeholder = '–ü—É—Ç—å –∫ EPUB —Ñ–∞–π–ª—É';
        sourceUrlLabel.textContent = '–ü—É—Ç—å –∫ EPUB —Ñ–∞–π–ª—É *';
        sourceUrlHelp.textContent = '–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ EPUB —Ñ–∞–π–ª—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ';
    } else {
        sourceUrlInput.type = 'url';
        sourceUrlInput.placeholder = 'URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞';
        sourceUrlLabel.textContent = 'URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ *';
        sourceUrlHelp.textContent = '–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ–≤–µ–ª–ª—ã';
    }
});

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ–∂–∏–º–∞ –∫–∞—á–µ—Å—Ç–≤–∞
document.getElementById('editing_quality_mode').addEventListener('change', function() {
    const mode = this.value;
    const temperatureDisplay = document.getElementById('editing_temperature_display');
    
    const temperatureMap = {
        'fast': 0.5,
        'balanced': 0.7,
        'quality': 0.9
    };
    
    if (temperatureMap[mode]) {
        temperatureDisplay.value = temperatureMap[mode];
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞ "–≤—Å–µ –≥–ª–∞–≤—ã"
const allChaptersCheckbox = document.getElementById('all_chapters');
const maxChaptersInput = document.getElementById('max_chapters');

if (allChaptersCheckbox && maxChaptersInput) {
    allChaptersCheckbox.addEventListener('change', function() {
        if (this.checked) {
            maxChaptersInput.disabled = true;
            maxChaptersInput.style.backgroundColor = '#e9ecef';
        } else {
            maxChaptersInput.disabled = false;
            maxChaptersInput.style.backgroundColor = '';
        }
    });
}
</script>
{% endblock %} 