{% extends "base.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å {{ novel.title }} - Novel Translator{% endblock %}
{% block page_title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å {{ novel.title }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-pencil-square"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–µ–ª–ª—É
                </h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–µ–ª–ª—ã *</label>
                        <input type="text" class="form-control" id="title" name="title" value="{{ novel.title }}" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="original_title" class="form-label">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" class="form-control" id="original_title" name="original_title" value="{{ novel.original_title or '' }}">
                        <div class="form-text">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —è–∑—ã–∫–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="author" class="form-label">–ê–≤—Ç–æ—Ä</label>
                        <input type="text" class="form-control" id="author" name="author" value="{{ novel.author or '' }}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="source_url" class="form-label">URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ *</label>
                        <input type="url" class="form-control" id="source_url" name="source_url" value="{{ novel.source_url }}" required>
                        <div class="form-text">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–æ–≤–µ–ª–ª—ã</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="source_type" class="form-label">–¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞</label>
                        <select class="form-select" id="source_type" name="source_type">
                            <option value="novelbins" {{ 'selected' if novel.source_type == 'novelbins' else '' }}>NovelBins</option>
                            <option value="webnovel" {{ 'selected' if novel.source_type == 'webnovel' else '' }}>WebNovel</option>
                            <option value="other" {{ 'selected' if novel.source_type == 'other' else '' }}>–î—Ä—É–≥–æ–π</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="prompt_template_id" class="form-label">–®–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞</label>
                        <select class="form-select" id="prompt_template_id" name="prompt_template_id">
                            <option value="none" {{ 'selected' if not novel.prompt_template_id else '' }}>–ë–µ–∑ —à–∞–±–ª–æ–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                            {% for template in prompt_templates %}
                            <option value="{{ template.id }}" {{ 'selected' if novel.prompt_template_id == template.id else '' }}>
                                {{ template.name }} ({{ template.category }})
                            </option>
                            {% endfor %}
                        </select>
                        <div class="form-text">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —ç—Ç–æ–π –Ω–æ–≤–µ–ª–ª—ã</div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="max_chapters" class="form-label">–ú–∞–∫—Å–∏–º—É–º –≥–ª–∞–≤</label>
                                <!-- –û—Ç–ª–∞–¥–∫–∞: max_chapters = {{ novel.config.max_chapters if novel.config and novel.config.max_chapters else '–ù–ï–¢ –ó–ù–ê–ß–ï–ù–ò–Ø' }} -->
                                <div class="input-group">
                                    <input type="number" class="form-control" id="max_chapters" name="max_chapters" 
                                           value="{{ novel.config.max_chapters if novel.config and novel.config.max_chapters else 100 }}" 
                                           min="1" max="1000" 
                                           {{ 'disabled style="background-color: #e9ecef;"' if novel.config and novel.config.all_chapters else '' }}>
                                </div>
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" id="all_chapters" name="all_chapters" value="true"
                                           {{ 'checked' if novel.config and novel.config.all_chapters else '' }}>
                                    <label class="form-check-label" for="all_chapters">
                                        –í—Å–µ –≥–ª–∞–≤—ã (–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ)
                                    </label>
                                </div>
                                <div class="form-text">–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {{ novel.config.max_chapters if novel.config and novel.config.max_chapters else '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ' }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="request_delay" class="form-label">–ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫)</label>
                                <input type="number" class="form-control" id="request_delay" name="request_delay" 
                                       value="{{ novel.config.request_delay if novel.config and novel.config.request_delay else 1.0 }}" 
                                       min="0.1" max="10" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞</h6>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i>
                        <strong>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–ª–∞–≤–∞–º:</strong>
                        <ol class="mb-0 mt-2">
                            <li>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç–µ-–∏—Å—Ç–æ—á–Ω–∏–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Qidian.com)</li>
                            <li>–í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
                            <li>–û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools (F12) ‚Üí Network</li>
                            <li>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ Cookie –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤</li>
                            <li>–í—Å—Ç–∞–≤—å—Ç–µ cookies –≤ –ø–æ–ª–µ –Ω–∏–∂–µ</li>
                        </ol>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="auth_enabled" name="auth_enabled" value="true"
                                   {{ 'checked' if novel.auth_enabled else '' }}>
                            <label class="form-check-label" for="auth_enabled">
                                <strong>–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</strong>
                            </label>
                        </div>
                        <div class="form-text">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å cookies –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–ª–∞–≤–∞–º</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="auth_cookies" class="form-label">Cookies –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</label>
                        <textarea class="form-control" id="auth_cookies" name="auth_cookies" rows="3" 
                                  placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ cookies –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞...">{{ novel.auth_cookies or '' }}</textarea>
                        <div class="form-text">
                            <strong>–ü—Ä–∏–º–µ—Ä:</strong> <code>sessionid=abc123; user_id=456; token=xyz789</code><br>
                            <strong>–°—Ç–∞—Ç—É—Å:</strong> 
                            {% if novel.auth_enabled and novel.auth_cookies %}
                                <span class="text-success">‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞</span>
                            {% else %}
                                <span class="text-muted">‚ùå –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞</span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∞</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="translation_model" class="form-label">–ú–æ–¥–µ–ª—å –ø–µ—Ä–µ–≤–æ–¥–∞</label>
                                <select class="form-select" id="translation_model" name="translation_model">
                                    <option value="gemini-2.5-flash-preview-05-20" 
                                            {{ 'selected' if not novel.config or novel.config.translation_model == 'gemini-2.5-flash-preview-05-20' else '' }}>
                                        Gemini 2.5 Flash
                                    </option>
                                    <option value="gpt-4o" 
                                            {{ 'selected' if novel.config and novel.config.translation_model == 'gpt-4o' else '' }}>
                                        GPT-4o
                                    </option>
                                    <option value="claude-3-5-sonnet" 
                                            {{ 'selected' if novel.config and novel.config.translation_model == 'claude-3-5-sonnet' else '' }}>
                                        Claude 3.5 Sonnet
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="translation_temperature" class="form-label">–¢–æ—á–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞</label>
                                <input type="number" class="form-control" id="translation_temperature" name="translation_temperature" 
                                       value="{{ novel.config.translation_temperature if novel.config and novel.config.translation_temperature else 0.1 }}" 
                                       min="0" max="1" step="0.1">
                                <div class="form-text">–¢–æ—á–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ (0-1). 0 = –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, 1 = –±–æ–ª–µ–µ —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥</div>
                            </div>
                        </div>
                    </div>
                    
                    <hr>
                    <h6 class="mb-3">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editing_quality_mode" class="form-label">–†–µ–∂–∏–º –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                                <select class="form-select" id="editing_quality_mode" name="editing_quality_mode">
                                    <option value="fast" {{ 'selected' if not novel.config or novel.config.editing_quality_mode == 'fast' else '' }}>
                                        –ë—ã—Å—Ç—Ä–æ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.5)
                                    </option>
                                    <option value="balanced" {{ 'selected' if novel.config and novel.config.editing_quality_mode == 'balanced' else '' }}>
                                        –ë–∞–ª–∞–Ω—Å (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.7)
                                    </option>
                                    <option value="quality" {{ 'selected' if novel.config and novel.config.editing_quality_mode == 'quality' else '' }}>
                                        –ö–∞—á–µ—Å—Ç–≤–æ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.9)
                                    </option>
                                </select>
                                <div class="form-text">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="editing_temperature_display" class="form-label">–¢–µ–∫—É—â–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                                <input type="text" class="form-control" id="editing_temperature_display" readonly 
                                       value="{{ novel.config.editing_temperature if novel.config and novel.config.editing_temperature else '0.7' }}">
                                <div class="form-text">–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –∫–∞—á–µ—Å—Ç–≤–∞</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('main.novel_detail', novel_id=novel.id) }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ–∂–∏–º–∞ –∫–∞—á–µ—Å—Ç–≤–∞
document.getElementById('editing_quality_mode').addEventListener('change', function() {
    const mode = this.value;
    const temperatureDisplay = document.getElementById('editing_temperature_display');
    
    const temperatureMap = {
        'fast': 0.5,
        'balanced': 0.7,
        'quality': 0.9
    };
    
    if (temperatureMap[mode]) {
        temperatureDisplay.value = temperatureMap[mode];
    }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞ "–≤—Å–µ –≥–ª–∞–≤—ã"
const allChaptersCheckbox = document.getElementById('all_chapters');
const maxChaptersInput = document.getElementById('max_chapters');

if (allChaptersCheckbox && maxChaptersInput) {
    allChaptersCheckbox.addEventListener('change', function() {
        if (this.checked) {
            maxChaptersInput.disabled = true;
            maxChaptersInput.style.backgroundColor = '#e9ecef';
        } else {
            maxChaptersInput.disabled = false;
            maxChaptersInput.style.backgroundColor = '';
        }
    });
}
</script>
{% endblock %} 