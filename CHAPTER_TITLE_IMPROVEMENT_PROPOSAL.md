# üí° –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–ª–∞–≤—ã

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### –ö–∞–∫ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç:

```python
# 1. –ü–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –í–°–Ø –≥–ª–∞–≤–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ + —Ç–µ–∫—Å—Ç) –û–î–ù–ò–ú –∑–∞–ø—Ä–æ—Å–æ–º
translated_full = translator.translate_text(
    text="Á¨¨‰∏ÄÁ´† ÁôΩÂ∞èÁ∫Ø\n\nÁôΩÂ∞èÁ∫ØÁùÅÂºÄÁúºÁùõ...",  # –ù–∞–∑–≤–∞–Ω–∏–µ + —Ç–µ–∫—Å—Ç
    context=context_prompt,                      # –ì–ª–æ—Å—Å–∞—Ä–∏–π + —Ä–µ–∑—é–º–µ
    temperature=0.1
)
# ‚Üí "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω—å\n\n–ë–∞–π –°—è–æ—á—É–Ω—å –æ—Ç–∫—Ä—ã–ª –≥–ª–∞–∑–∞..."

# 2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–ª–≥–æ—Ä–∏—Ç–º
title, content = extract_title_and_content(translated_full)
# ‚Üí title = "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω—å"
```

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. ‚ùå **–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≥–ª–æ—Å—Å–∞—Ä–∏—é**
   ```
   –ì–ª–æ—Å—Å–∞—Ä–∏–π: "Bai Xiaochun" ‚Üí "–ë–∞–π –°—è–æ—á—É–Ω—å"
   LLM –ø–µ—Ä–µ–≤–µ–ª: "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω" (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   ```

2. ‚ùå **LLM –º–æ–∂–µ—Ç "–∑–∞–±—ã—Ç—å" –æ –≥–ª–æ—Å—Å–∞—Ä–∏–∏ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è**
   ```
   –ù–∞–∑–≤–∞–Ω–∏–µ: "Á¨¨‰∫îÁ´† Èáë‰∏πÊúü"
   –ì–ª–æ—Å—Å–∞—Ä–∏–π: "Golden Core" ‚Üí "–ó–æ–ª–æ—Ç–æ–µ –Ø–¥—Ä–æ"
   LLM –ø–µ—Ä–µ–≤–µ–ª: "–ì–ª–∞–≤–∞ 5: –°—Ç–∞–¥–∏—è –ó–æ–ª–æ—Ç–æ–≥–æ –Ø–¥—Ä–∞" (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   –ù–æ –º–æ–≥ –±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏: "–ì–ª–∞–≤–∞ 5: –≠—Ç–∞–ø –ó–æ–ª–æ—Ç–æ–≥–æ –Ø–¥—Ä–∞" (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
   ```

3. ‚ùå **–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ä—è–µ—Ç—Å—è –≤ –±–æ–ª—å—à–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ**
   ```
   –ì–ª–∞–≤–∞ 10000 —Å–∏–º–≤–æ–ª–æ–≤:
   "Á¨¨‰∏ÄÁ´† ÁôΩÂ∞èÁ∫Ø\n\n[–æ–≥—Ä–æ–º–Ω—ã–π —Ç–µ–∫—Å—Ç...]"

   LLM –º–æ–∂–µ—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —Ç–µ–∫—Å—Ç–µ –∏ –Ω–µ–±—Ä–µ–∂–Ω–æ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
   ```

---

## üîß –í–∞—Ä–∏–∞–Ω—Ç—ã —É–ª—É—á—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è —Å –≥–ª–æ—Å—Å–∞—Ä–∏–µ–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –û–ø–∏—Å–∞–Ω–∏–µ:
–ü–µ—Ä–µ–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ **–æ—Ç–¥–µ–ª—å–Ω—ã–º –∑–∞–ø—Ä–æ—Å–æ–º** —Å –≥–ª–æ—Å—Å–∞—Ä–∏–µ–º **–î–û** –ø–µ—Ä–µ–≤–æ–¥–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
def translate_chapter(self, chapter: Chapter) -> bool:
    # ... (–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≥–ª–æ—Å—Å–∞—Ä–∏—è)

    # ========== –ù–û–í–û–ï: –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è ==========
    if chapter.original_title:
        translated_title = self.translate_title_with_glossary(
            original_title=chapter.original_title,
            glossary=context.glossary,
            chapter_id=chapter.id
        )
        LogService.log_info(f"–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ: '{translated_title}'")
    else:
        translated_title = None

    # –û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ (–ë–ï–ó –Ω–∞–∑–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–æ —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ)
    text_to_translate = self.preprocess_text(chapter.original_text)
    text_parts = self.split_long_text(text_to_translate)

    translated_parts = []
    for part in text_parts:
        translated_part = self.translator.translate_text(
            part,
            prompt_template.translation_prompt,
            context_prompt,
            chapter.id
        )
        translated_parts.append(translated_part)

    full_translation = "\n\n".join(translated_parts)

    # ========== –ò–ó–ú–ï–ù–ï–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è ==========
    if translated_title:
        # –ù–∞–∑–≤–∞–Ω–∏–µ —É–∂–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ
        title = translated_title
        content = full_translation
    else:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ (—Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥)
        title, content = self.extract_title_and_content(full_translation)

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
    translation = Translation(
        translated_title=title,
        translated_text=content,
        ...
    )
```

#### –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ translate_title_with_glossary():

```python
def translate_title_with_glossary(self, original_title: str, glossary: Dict, chapter_id: int) -> str:
    """
    –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–ª–∞–≤—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–ª–æ—Å—Å–∞—Ä–∏—è

    Args:
        original_title: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "Á¨¨‰∏ÄÁ´† ÁôΩÂ∞èÁ∫Ø")
        glossary: –ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤
        chapter_id: ID –≥–ª–∞–≤—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

    Returns:
        –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω—å")
    """

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è
    glossary_text = self._format_glossary_for_prompt(glossary)

    title_prompt = f"""
–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –∫–∏—Ç–∞–π—Å–∫–∏—Ö –≤–µ–±-–Ω–æ–≤–µ–ª–ª –∂–∞–Ω—Ä–∞ —Å—è–Ω—å—Å—è.

–ó–ê–î–ê–ß–ê: –ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã —Å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π.

–í–ê–ñ–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ï —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è (–∏–º–µ–Ω–∞, –ª–æ–∫–∞—Ü–∏–∏, —Ç–µ—Ö–Ω–∏–∫–∏)
2. –°–æ—Ö—Ä–∞–Ω–∏ —Ñ–æ—Ä–º–∞—Ç: "–ì–ª–∞–≤–∞ N: –ù–∞–∑–≤–∞–Ω–∏–µ"
3. –ï—Å–ª–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –Ω–µ—Ç —Å–ª–æ–≤–∞ "–≥–ª–∞–≤–∞" - –¥–æ–±–∞–≤—å –µ–≥–æ
4. –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º –∏ –µ–º–∫–∏–º
5. –ù–ï –¥–æ–±–∞–≤–ª—è–π —Ç–æ—á–∫—É –≤ –∫–æ–Ω—Ü–µ

–ì–õ–û–°–°–ê–†–ò–ô:
{glossary_text}

–ù–ê–ó–í–ê–ù–ò–ï –î–õ–Ø –ü–ï–†–ï–í–û–î–ê:
{original_title}

–ü–ï–†–ï–í–ï–î–ï–ù–ù–û–ï –ù–ê–ó–í–ê–ù–ò–ï (—Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤):"""

    # –ó–∞–ø—Ä–æ—Å –∫ LLM —Å –Ω–∏–∑–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–æ–π –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
    translated_title = self.translator.make_request(
        system_prompt=title_prompt,
        user_prompt=original_title,
        temperature=0.0  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
    )

    if not translated_title:
        LogService.log_error(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–ª–∞–≤—ã: {original_title}")
        return f"–ì–ª–∞–≤–∞ {chapter_id}"  # Fallback

    # –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞: —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
    translated_title = translated_title.strip()
    translated_title = translated_title.rstrip('.')  # –£–¥–∞–ª—è–µ–º —Ç–æ—á–∫—É –≤ –∫–æ–Ω—Ü–µ
    translated_title = translated_title.strip('"\'')  # –£–¥–∞–ª—è–µ–º –∫–∞–≤—ã—á–∫–∏

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
    if not translated_title or len(translated_title) > 200:
        LogService.log_warning(f"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è: '{translated_title}'. –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback.")
        return f"–ì–ª–∞–≤–∞ {chapter_id}"

    return translated_title
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. ‚úÖ **–¢–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏—é**: LLM –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≥–ª–æ—Å—Å–∞—Ä–∏–π –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ
2. ‚úÖ **–í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å**: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ 0.0 –¥–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
3. ‚úÖ **–§–æ–∫—É—Å –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–∏**: LLM –Ω–µ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã
4. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–æ–≤ –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è
5. ‚úÖ **–û—Ç–¥–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ª–µ–≥–∫–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞–∑–≤–∞–Ω–∏–π

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

1. ‚ö†Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ API**: +1 –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª–∞–≤—É
   - –î–ª—è 1000 –≥–ª–∞–≤ = +1000 –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ù–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–µ (~10-50 —Ç–æ–∫–µ–Ω–æ–≤), —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–∞

2. ‚ö†Ô∏è **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏**: +2-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≥–ª–∞–≤—É
   - –î–ª—è 1000 –≥–ª–∞–≤ = +30-80 –º–∏–Ω—É—Ç –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
   - –ù–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º —Ç–µ–∫—Å—Ç–∞

3. ‚ö†Ô∏è **–ü–æ—Ç–µ—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –≤–∏–¥–∏—Ç —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã
   - –ù–æ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π —ç—Ç–æ –æ–±—ã—á–Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞

#### –û–ø–∏—Å–∞–Ω–∏–µ:
–°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤—Å—é –≥–ª–∞–≤—É –∫–∞–∫ —Å–µ–π—á–∞—Å, –∑–∞—Ç–µ–º **–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏—é** –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ **–ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å**.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
def translate_chapter(self, chapter: Chapter) -> bool:
    # ... (—Ç–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞)

    # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
    title, content = self.extract_title_and_content(full_translation)

    # ========== –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è ==========
    if title:
        corrected_title = self.validate_and_correct_title(
            title=title,
            original_title=chapter.original_title,
            glossary=context.glossary,
            chapter_id=chapter.id
        )

        if corrected_title != title:
            LogService.log_info(f"–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ: '{title}' ‚Üí '{corrected_title}'")
            title = corrected_title

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
```

#### –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ validate_and_correct_title():

```python
def validate_and_correct_title(self, title: str, original_title: str,
                               glossary: Dict, chapter_id: int) -> str:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏—é –∏ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

    Args:
        title: –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        original_title: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        glossary: –ì–ª–æ—Å—Å–∞—Ä–∏–π —Ç–µ—Ä–º–∏–Ω–æ–≤
        chapter_id: ID –≥–ª–∞–≤—ã

    Returns:
        –°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    """

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è
    found_issues = []

    # –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≥–ª–æ—Å—Å–∞—Ä–∏—è
    for category, terms in glossary.items():
        for english_term, russian_term in terms.items():
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ—Ä–º–∏–Ω –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –Ω–∞–∑–≤–∞–Ω–∏–∏
            if english_term.lower() in original_title.lower():
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä—É—Å—Å–∫–∏–π —Ç–µ—Ä–º–∏–Ω –≤ –ø–µ—Ä–µ–≤–æ–¥–µ
                if russian_term not in title:
                    found_issues.append({
                        'english': english_term,
                        'expected_russian': russian_term,
                        'category': category
                    })

    # –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if not found_issues:
        return title

    # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ü–∏—é —É LLM
    LogService.log_warning(
        f"–ù–∞–π–¥–µ–Ω—ã –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≥–ª–æ—Å—Å–∞—Ä–∏—é –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏: {found_issues}",
        chapter_id=chapter_id
    )

    correction_prompt = f"""
–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∫–∏—Ç–∞–π—Å–∫–∏—Ö –≤–µ–±-–Ω–æ–≤–µ–ª–ª.

–ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤—å –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –≥–ª–∞–≤—ã, —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –≥–ª–æ—Å—Å–∞—Ä–∏—é.

–û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ï –ù–ê–ó–í–ê–ù–ò–ï (–∫–∏—Ç–∞–π—Å–∫–∏–π):
{original_title}

–¢–ï–ö–£–©–ò–ô –ü–ï–†–ï–í–û–î:
{title}

–ù–ê–ô–î–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:
{self._format_issues(found_issues)}

–ì–õ–û–°–°–ê–†–ò–ô (–∏—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–û —ç—Ç–∏ –ø–µ—Ä–µ–≤–æ–¥—ã):
{self._format_glossary_for_prompt(glossary)}

–ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –ù–ê–ó–í–ê–ù–ò–ï (—Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π):"""

    corrected_title = self.translator.make_request(
        system_prompt=correction_prompt,
        user_prompt=title,
        temperature=0.0
    )

    if not corrected_title or len(corrected_title) > 200:
        LogService.log_error(f"–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å")
        return title

    # –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞
    corrected_title = corrected_title.strip().rstrip('.').strip('"\'')

    return corrected_title
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. ‚úÖ **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–∫—Å—Ç–∞ + —Ç–æ—á–Ω–æ—Å—Ç—å –≥–ª–æ—Å—Å–∞—Ä–∏—è
2. ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏**: –µ—Å–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ - –Ω–µ –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
3. ‚úÖ **–î–µ—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è
4. ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

1. ‚ö†Ô∏è **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**: –Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ—Ä–º–∏–Ω–æ–≤
2. ‚ö†Ô∏è **–ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã**: –µ—Å–ª–∏ —Ç–µ—Ä–º–∏–Ω –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –ø–æ—Ö–æ–∂–µ, –Ω–æ –Ω–µ—Ç–æ—á–Ω–æ
3. ‚ö†Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö**: +1 –∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª–∞–≤—É —Å –ø—Ä–æ–±–ª–µ–º–æ–π

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)

#### –û–ø–∏—Å–∞–Ω–∏–µ:
–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç **—è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ—Å—Å–∞—Ä–∏–π –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

```python
# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ translation_prompt (PromptTemplate)

–°–¢–ê–†–´–ô –ü–†–û–ú–ü–¢:
"""
–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –∫–∏—Ç–∞–π—Å–∫–∏—Ö –≤–µ–±-–Ω–æ–≤–µ–ª–ª –∂–∞–Ω—Ä–∞ —Å—è–Ω—Å—è.

–ó–ê–î–ê–ß–ê: –ü–µ—Ä–µ–≤–µ–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç —Å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. –°–æ—Ö—Ä–∞–Ω–∏ –≤—Å–µ –∏–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è
2. –ü–µ—Ä–µ–≤–µ–¥–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ
...
"""

–ù–û–í–´–ô –ü–†–û–ú–ü–¢:
"""
–¢—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –∫–∏—Ç–∞–π—Å–∫–∏—Ö –≤–µ–±-–Ω–æ–≤–µ–ª–ª –∂–∞–Ω—Ä–∞ —Å—è–Ω—Å—è.

–ó–ê–î–ê–ß–ê: –ü–µ—Ä–µ–≤–µ–¥–∏ —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç —Å –∫–∏—Ç–∞–π—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
1. **–û–°–û–ë–û–ï –í–ù–ò–ú–ê–ù–ò–ï –ö –ù–ê–ó–í–ê–ù–ò–Æ –ì–õ–ê–í–´** (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–µ–∫—Å—Ç–∞):
   - –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–ß–ù–´–ï —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è –¥–ª—è –∏–º–µ–Ω, –ª–æ–∫–∞—Ü–∏–π, —Ç–µ—Ö–Ω–∏–∫
   - –§–æ—Ä–º–∞—Ç: "–ì–ª–∞–≤–∞ N: –ù–∞–∑–≤–∞–Ω–∏–µ"
   - –ù–ï –¥–æ–±–∞–≤–ª—è–π —Ç–æ—á–∫—É –≤ –∫–æ–Ω—Ü–µ –Ω–∞–∑–≤–∞–Ω–∏—è
   - –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–∫–∏–º –∏ —Ç–æ—á–Ω—ã–º

2. –°–æ—Ö—Ä–∞–Ω–∏ –≤—Å–µ –∏–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –∏ —Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è –≤ —Ç–µ–∫—Å—Ç–µ –≥–ª–∞–≤—ã
3. –ü–µ—Ä–µ–≤–µ–¥–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —Ç–æ—á–Ω–æ
...
"""
```

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. ‚úÖ **–ù—É–ª–µ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å**: –Ω–µ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
2. ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**: —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
3. ‚úÖ **–ë—ã—Å—Ç—Ä–æ**: –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫
4. ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç**: –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–∏—Ç —Ç–µ–∫—Å—Ç –≥–ª–∞–≤—ã

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:

1. ‚ùå **–ù–µ–Ω–∞–¥–µ–∂–Ω–æ**: LLM –º–æ–∂–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
2. ‚ùå **–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç "–≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏" –º–æ–¥–µ–ª–∏
3. ‚ùå **–°–ª–æ–∂–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å**: –Ω–µ—Ç —è–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ | –í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ—Ä—Ä–µ–∫—Ü–∏—è | –í–∞—Ä–∏–∞–Ω—Ç 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ |
|----------|------------------------------|---------------------|------------------------------|
| **–¢–æ—á–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è | ‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è | ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è | ‚≠ê‚≠ê –ù–∏–∑–∫–∞—è |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê +1 –∑–∞–ø—Ä–æ—Å/–≥–ª–∞–≤–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê +0.5 –∑–∞–ø—Ä–æ—Å–∞/–≥–ª–∞–≤–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ë–µ—Å–ø–ª–∞—Ç–Ω–æ |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê +2-5 —Å–µ–∫/–≥–ª–∞–≤–∞ | ‚≠ê‚≠ê‚≠ê‚≠ê +1-3 —Å–µ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ë–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫ |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | ‚≠ê‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è | ‚≠ê‚≠ê –°–ª–æ–∂–Ω–∞—è | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –ü—Ä–æ—Å—Ç–∞—è |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç** | ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ç–µ–∫—Å—Ç–∞ | ‚úÖ –ï—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç | ‚úÖ –ï—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | ‚úÖ –õ–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å | ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚ùå –°–ª–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

### –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –í–∞—Ä–∏–∞–Ω—Ç 1 + –í–∞—Ä–∏–∞–Ω—Ç 3:

```python
def translate_chapter(self, chapter: Chapter) -> bool:
    # ... (–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–∞, –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≥–ª–æ—Å—Å–∞—Ä–∏—è)

    # ========== –≠–¢–ê–ü 1: –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–í–∞—Ä–∏–∞–Ω—Ç 3) ==========
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–π translation_prompt —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ

    # ========== –≠–¢–ê–ü 2: –û—Å–Ω–æ–≤–Ω–æ–π –ø–µ—Ä–µ–≤–æ–¥ ==========
    translated_parts = []
    for part in text_parts:
        translated_part = self.translator.translate_text(
            part,
            enhanced_translation_prompt,  # ‚Üê –° –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ
            context_prompt,
            chapter.id
        )
        translated_parts.append(translated_part)

    full_translation = "\n\n".join(translated_parts)

    # ========== –≠–¢–ê–ü 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è ==========
    title, content = self.extract_title_and_content(full_translation)

    # ========== –≠–¢–ê–ü 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –í–∞—Ä–∏–∞–Ω—Ç 2) ==========
    if title and chapter.original_title:
        # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –Ω–∞–∑–≤–∞–Ω–∏–∏ –∏–º–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
        character_names = self._extract_character_names_from_glossary(context.glossary)

        needs_retranslation = False
        for original_name, russian_name in character_names.items():
            if original_name in chapter.original_title and russian_name not in title:
                LogService.log_warning(
                    f"–ò–º—è '{original_name}' –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≥–ª–æ—Å—Å–∞—Ä–∏—é. "
                    f"–û–∂–∏–¥–∞–µ—Ç—Å—è: '{russian_name}', –≤ –ø–µ—Ä–µ–≤–æ–¥–µ: '{title}'"
                )
                needs_retranslation = True
                break

        # ========== –≠–¢–ê–ü 5: –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ (–í–∞—Ä–∏–∞–Ω—Ç 1) - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö ==========
        if needs_retranslation:
            LogService.log_info("–ü–µ—Ä–µ–≤–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ –∏–∑-–∑–∞ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≥–ª–æ—Å—Å–∞—Ä–∏—é")
            title = self.translate_title_with_glossary(
                original_title=chapter.original_title,
                glossary=context.glossary,
                chapter_id=chapter.id
            )

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1. ‚úÖ **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å**: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
2. ‚úÖ **–í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å**: —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç + –ø—Ä–æ–≤–µ—Ä–∫–∞ + –∫–æ—Ä—Ä–µ–∫—Ü–∏—è
3. ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
4. ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –µ—Å—Ç—å fallback –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

---

## üí∞ –û—Ü–µ–Ω–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

### –î–ª—è –Ω–æ–≤–µ–ª–ª—ã 1000 –≥–ª–∞–≤:

**–í–∞—Ä–∏–∞–Ω—Ç 1 (–æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –≤—Å–µ—Ö –Ω–∞–∑–≤–∞–Ω–∏–π):**
```
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 1000 –Ω–∞–∑–≤–∞–Ω–∏–π
–¢–æ–∫–µ–Ω—ã –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ: ~30-50 —Ç–æ–∫–µ–Ω–æ–≤ (input) + ~20-40 —Ç–æ–∫–µ–Ω–æ–≤ (output)
–°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å: 70 —Ç–æ–∫–µ–Ω–æ–≤

Gemini 2.0 Flash:
- Input: 1000 √ó 40 = 40,000 —Ç–æ–∫–µ–Ω–æ–≤ √ó $0.075/1M = $0.003
- Output: 1000 √ó 30 = 30,000 —Ç–æ–∫–µ–Ω–æ–≤ √ó $0.30/1M = $0.009
–ò–¢–û–ì–û: ~$0.012 (1‚ÇΩ)

–í—Ä–µ–º—è: +2-5 —Å–µ–∫/–≥–ª–∞–≤–∞ = +30-80 –º–∏–Ω—É—Ç
```

**–í–∞—Ä–∏–∞–Ω—Ç 2 (–∫–æ—Ä—Ä–µ–∫—Ü–∏—è ~10% –Ω–∞–∑–≤–∞–Ω–∏–π —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏):**
```
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: ~100 –∫–æ—Ä—Ä–µ–∫—Ü–∏–π
–¢–æ–∫–µ–Ω—ã: –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –í–∞—Ä–∏–∞–Ω—Ç—É 1

–ò–¢–û–ì–û: ~$0.0012 (0.1‚ÇΩ)
–í—Ä–µ–º—è: +1-3 —Å–µ–∫ –Ω–∞ 100 –≥–ª–∞–≤ = +2-5 –º–∏–Ω—É—Ç
```

**–í–∞—Ä–∏–∞–Ω—Ç 3 (—É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞):**
```
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: 0
–ò–¢–û–ì–û: $0 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
–í—Ä–µ–º—è: 0
```

**–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–í–∞—Ä–∏–∞–Ω—Ç 3 + –í–∞—Ä–∏–∞–Ω—Ç 1 –¥–ª—è ~5% –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö):**
```
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã: ~50 –∫–æ—Ä—Ä–µ–∫—Ü–∏–π
–ò–¢–û–ì–û: ~$0.0006 (0.05‚ÇΩ)
–í—Ä–µ–º—è: +1-3 —Å–µ–∫ –Ω–∞ 50 –≥–ª–∞–≤ = +1-3 –º–∏–Ω—É—Ç—ã
```

---

## üöÄ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–ø–æ—à–∞–≥–æ–≤—ã–π)

### –®–∞–≥ 1: –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç (–í–∞—Ä–∏–∞–Ω—Ç 3)
- –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ü–µ–Ω—Ç –Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 10-20 –≥–ª–∞–≤–∞—Ö
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏—é

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ translate_title_with_glossary() (–í–∞—Ä–∏–∞–Ω—Ç 1)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞–∑–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ –∫–æ–Ω—Ñ–∏–≥ Novel
```python
novel.config = {
    'translate_title_separately': False,  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ
    'validate_title_glossary': True,      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ—Å—Å–∞—Ä–∏—è –≤–∫–ª—é—á–µ–Ω–∞
    ...
}
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ 100 –≥–ª–∞–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –í—ã–±—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### –®–∞–≥ 5: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
- –í–∫–ª—é—á–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤–µ–ª–ª
- –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–∞–∫ –æ–ø—Ü–∏—é

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ù–∞–∑–≤–∞–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

```python
# –û—Ä–∏–≥–∏–Ω–∞–ª
original_title = "Á¨¨‰∏ÄÁ´† ÁôΩÂ∞èÁ∫Ø"

# –ì–ª–æ—Å—Å–∞—Ä–∏–π
glossary = {
    'characters': {
        'Bai Xiaochun': '–ë–∞–π –°—è–æ—á—É–Ω—å'
    }
}

# –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ (–º–æ–∂–µ—Ç –æ—à–∏–±–∏—Ç—å—Å—è)
‚Üí "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω"  # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

# –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
1. –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç ‚Üí "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω—å"  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
2. –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ ‚Üí "–ì–ª–∞–≤–∞ 1: –ë–∞–π –°—è–æ—á—É–Ω—å"  # ‚úÖ
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–∞–∑–≤–∞–Ω–∏–µ —Å —Ç–µ—Ö–Ω–∏–∫–æ–π

```python
# –û—Ä–∏–≥–∏–Ω–∞–ª
original_title = "Á¨¨‰∏âÁôæÁ´† Èáë‰∏πÂ§ßÊàê"

# –ì–ª–æ—Å—Å–∞—Ä–∏–π
glossary = {
    'techniques': {
        'Golden Core': '–ó–æ–ª–æ—Ç–æ–µ –Ø–¥—Ä–æ'
    }
}

# –¢–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥
‚Üí "–ì–ª–∞–≤–∞ 300: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ó–æ–ª–æ—Ç–æ–≥–æ –Ø–¥—Ä–∞"  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ—Å—Å–∞—Ä–∏—è
‚Üí "–ó–æ–ª–æ—Ç–æ–µ –Ø–¥—Ä–æ" –Ω–∞–π–¥–µ–Ω–æ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
‚Üí –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –ù–ï –Ω—É–∂–µ–Ω
```

---

## üéì –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–±–µ–∑ –∫–æ–¥–∞)**:
   - ‚úÖ –£–ª—É—á—à–∏—Ç—å translation_prompt —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏—è (–í–∞—Ä–∏–∞–Ω—Ç 3)
   - –°—Ç–æ–∏–º–æ—Å—Ç—å: $0, –≤—Ä–µ–º—è: 0

2. **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è (1-2 –¥–Ω—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)**:
   - ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å translate_title_with_glossary() (–í–∞—Ä–∏–∞–Ω—Ç 1)
   - ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ novel.config
   - ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 50-100 –≥–ª–∞–≤–∞—Ö

3. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)**:
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å validate_and_correct_title() (–í–∞—Ä–∏–∞–Ω—Ç 2)
   - –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≥–ª–æ—Å—Å–∞—Ä–∏—é

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

- ‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–π**: 90% ‚Üí 98%+
- ‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–ª–æ—Å—Å–∞—Ä–∏—é**: 85% ‚Üí 99%+
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å**: ~$0.0006 –Ω–∞ 1000 –≥–ª–∞–≤
- ‚úÖ **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è**: +1-3 –º–∏–Ω—É—Ç—ã –Ω–∞ 1000 –≥–ª–∞–≤

### –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
1. –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–≤—Å–µ–≥–¥–∞)
2. –û—Ç–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏—è (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –æ–ø—Ü–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ

–≠—Ç–æ –¥–∞—Å—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç–∞—Ö! üéØ

---

**–°–æ–∑–¥–∞–Ω–æ:** 2025-11-24
